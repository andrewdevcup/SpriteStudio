var b5 = {}; 
b5.app = null, b5.data = {}, b5.version = 2.5, 'use strict', function() {
  for (var e = 0, t = ['ms', 'moz', 'webkit', 'o'], o = 0;
    o < t.length&&!window.requestAnimationFrame;
    ++o)window.requestAnimationFrame = window[t[o]+'RequestAnimationFrame'],
  window.cancelAnimationFrame = window[t[o]+'CancelAnimationFrame'] || window[t[o]+'CancelRequestAnimationFrame'];
  window.requestAnimationFrame || (window.requestAnimationFrame = function(t) {console.log("requestAnimationFrame not available, using alternative.");
    var o = new Date().getTime(), a = Math.max(0, 16-(o-e)), n = window.setTimeout(function() {
      t(o+a)}, a);
    return e = o+a, n;
  }),
  window.cancelAnimationFrame || (window.cancelAnimationFrame = function(e) {
    clearTimeout(e)})}(), 
  !window.OffscreenCanvas && (window.OffscreenCanvas = function(w,h) {
  	var e = document.createElement('canvas');
  	e.width = w,
  	e.height = h,
  	console.log("OffscreenCanvas not available, using alternative (Performance will decrease!)");
  	return e;
  }),
'use strict', 
b5.Ease = function() {}, b5.Ease.linear = 0, b5.Ease.quadin = 1, b5.Ease.quadout = 2, b5.Ease.cubicin = 3, b5.Ease.cubicout = 4, b5.Ease.quartin = 5, b5.Ease.quartout = 6, b5.Ease.sin = 7, b5.Ease.sinin = 7, b5.Ease.sinout = 8, b5.Ease.sininout = 9, b5.Ease.quadinout = 10, b5.Ease.cubicinout = 11, b5.Ease.quarticinout = 12, b5.Ease.bouncein = 13, b5.Ease.bounceout = 14, b5.Ease.bounceinout = 15, b5.Ease.backin = 16, b5.Ease.backout = 17, b5.Ease.backinout = 18, b5.Ease.circin = 19, b5.Ease.circout = 20, b5.Ease.circinout = 21, b5.Ease.expin = 22, b5.Ease.expout = 23, b5.Ease.expinout = 24, 
b5.Ease.easingFuncs = [function(e) {
    return e;
  }, function(e) {
    return e*e;
  }, function(e) {
    return e*(2-e)}, function(e) {
    return e*e*e;
  }, function(e) {
    return e -= 1,
    e*e*e+1;
  }, function(e) {
    return e*e*e*e;
  }, function(e) {
    return e -= 1,
    -(e*e*e*e-1)}, function(e) {
    return 1-Math.cos(e*Math.PI/2)}, function(e) {
    return Math.sin(e*Math.PI/2)}, function(e) {
    return 0.5*(1-Math.cos(Math.PI*e))}, function(e) {
    return 0.5 > e?2*e*e: -1+(4-2*e)*e;
  }, function(e) {
    return 0.5 > e?4*e*e*e: (e-1)*(2*e-2)*(2*e-2)+1;
  }, function(e) {
    return 0.5 > e?8*e*e*e*e: 1-8*--e*e*e*e
  }, function(e) {
    return 1-b5.Ease.easingFuncs[b5.Ease.bounceout](1-e)}, function(e) {
    return e < 1/2.75?7.5625*e*e: e < 2/2.75?7.5625*(e -= 1.5/2.75)*e+.75: e < 2.5/2.75?7.5625*(e -= 2.25/2.75)*e+.9375: 7.5625*(e -= 2.625/2.75)*e+.984375
  }, function(e) {
    return .5 > e?.5*b5.Ease.easingFuncs[b5.Ease.bounceout](2*e): .5*b5.Ease.easingFuncs[b5.Ease.bounceout](2*e-1)+.5
  }, function(e) {
    var t = 1.70158;
    return e*e*((t+1)*e-t)}, function(e) {
    var t = 1.70158;
    return--e*e*((t+1)*e+t)+1
  }, function(e) {
    var t = 1.525*1.70158;
    e = 1 > (e *= 2)?.5*(e*e*((t+1)*e-t)): .5*((e -= 2)*e*((t+1)*e+t)+2)}, function(e) {
    return 1-Math.sqrt(1-e*e)}, function(e) {
    return Math.sqrt(1- (--e)*e)}, function(e) {
    var t = Math.sqrt;
    e *= 2,
    e = 1 > e?-.5*(t(1-e*e)-1): .5*(t(1-(e -= 2)*e)+1)}, function(e) {
    return 0 == e?0: Math.pow(1024, e-1)}, function(e) {
    return 1 == e?e: 1-Math.pow(2, -10*e)}, function(e) {
    var t = Math.pow;
    return 0 == e?0: 1 == e?1: 1 > (e *= 2)?.5*t(1024, e-1): .5*(-t(2, -10*(e-1))+2)}], 'use strict', b5.Animation = function(e, t, o, a, n, r, i) {
  this.timeline = e,
  this.state = b5.Animation.AS_playing,
  this.time=-1e-6,
  this.repeats_left = r,
  this.index=-1,
  this.name = null,
  this.target = t,
  this.property = o,
  this.frames = a,
  this.times = n,
  this.easing = i,
  this.repeat = r,
  this.destroy=!0,
  this.actions = [],
  this.time_scale = 1,
  this.delay=-0.001,
  this.tween=!0,
  this.deactivate=!1,
  this.onEnd = null,
  this.onRepeat =	null;
}, b5.Animation.AS_playing = 0, b5.Animation.AS_paused = 1, b5.Animation.prototype.setRelative = function(e) {
  this.initial_value = e?this.target[this.property]: void 0;
}, b5.Animation.prototype.pause = function() {
  this.state = b5.Animation.AS_paused;
}, b5.Animation.prototype.play = function() {
  this.state = b5.Animation.AS_playing;
}, b5.Animation.prototype.restart = function() {
  this.state = b5.Animation.AS_playing,
  this.time = this.delay,
  this.index=-1,
  this.repeats_left = this.repeat;
}, b5.Animation.prototype.update = function(e) {
  if (this.state !== b5.Animation.AS_playing)return!1;
  e *= this.time_scale;
  var o = this.time+e,
  a = this.times,
  n = this.frames,
  r = a.length,
  i = this.index;
  if (0 > o) {
    var s = n[0];
    return void 0 !== this.initial_value && (s += this.initial_value),
    this.target[this.property] = s,
    this.time = o,
    !0;
  }if (1 >= r)return!1;
  for (var c = i, d;
    c < r;
    c++)if (d = a[c], o < d) {
    if (this.index = c, o >= a[0]) {
      if (this.index !== i) {
        var p = this.actions[this.index-1];
        void 0 !== p && p()}var l = a[c-1],
      y = n[c-1],
      _ = o-l;
      if (0 != _) {
        var s;
        if (this.tween) {
          var u = d-l,
          h = n[c]-y;
          s = void 0 === this.easing?y+h*_/u: y+h*b5.Ease.easingFuncs[this.easing[c-1]](_/u)} else s = y;
        void 0 !== this.initial_value && (s += this.initial_value),
        this.target[this.property] = s;
      }}break;
  }var g = a[a.length-1];
  if (o > g) {
    if (0 < this.repeat && this.repeats_left--, 0 === this.repeat || 0 < this.repeats_left) {
      for (;
        o >= g;
      )o -= g;
      null !== this.onRepeat && this.onRepeat(this);
      var s = n[0];
      void 0 !== this.initial_value && (s += this.initial_value),
      this.target[this.property] = s;
    } else {
      var s = n[a.length-1];
      void 0 !== this.initial_value && (s += this.initial_value),
      this.target[this.property] = s,
      this.state = b5.Animation.AS_paused,
      this.destroy && this.timeline.remove(this),
      //changed void 0 to regular check
      this.onEnd && this.onEnd(this),
      this.deactivate && (this.target._av=!1)}this.index=-1;
  }return this.time = o,
  !0
}, b5.Animation.prototype.setTime = function(e) {
  this.time = e,
  this.index=-1,
  this.update(0)}, b5.Animation.prototype.setAction = function(e, t) {
  this.actions[e] = t
}, 'use strict', b5.Timeline = function(e, t, o, a, n, r) {
  this.anims = [],
  this.manager = null,
  this.name = null,
  this.playing=!1,
  e !== void 0 && this.add(e, t, o, a, n, r)}, b5.Timeline.prototype.setRelative = function(e) {
  for (var o = this.anims, a = o.length, n = 0;
    n < a;
    n++)o[n].setRelative(e)}, b5.Timeline.prototype.setRepeats = function(e) {
  for (var o = this.anims, a = o.length, n = 0;
    n < a;
    n++)o[n].repeat = e,
  o[n].repeats_left = e
}, b5.Timeline.prototype.add = function(e, t, o, a, n, r) {
  if (1 == arguments.length)return e.timeline = this,
  this.anims.push(e),
  e;
  var i = new b5.Animation(this, e, t, o, a, n, r);
  return this.anims.push(i),
  i
}, b5.Timeline.prototype.remove = function(e) {
  for (var o = this.anims, a = o.length, n = 0;
    n < a;
    n++)if (o[n] === e)return void o.splice(n, 1)}, b5.Timeline.prototype.changeTarget = function(e) {
  for (var o = this.anims, a = o.length, n = 0;
    n < a;
    n++)o[n].target = e
}, b5.Timeline.prototype.find = function(e) {
  for (var o = this.anims, a = o.length, n = 0;
    n < a;
    n++)if (o[n].name === e)return o[n];
  return null
}, b5.Timeline.prototype.setDelay = function(e) {
  for (var o = this.anims, a = o.length, n = 0;
    n < a;
    n++)o[n].delay=-e,
  o[n].time=-e
}, b5.Timeline.prototype.pause = function() {
  for (var e = this.anims.length, o = 0;
    o < e;
    o++)this.anims[o].pause()}, b5.Timeline.prototype.play = function() {
  for (var e = this.anims.length, o = 0;
    o < e;
    o++)this.anims[o].play()}, b5.Timeline.prototype.restart = function() {
  for (var e = this.anims.length, o = 0;
    o < e;
    o++)this.anims[o].restart()}, b5.Timeline.prototype.print = function() {
  for (var e = this.anims.length, o = 0;
    o < e;
    o++)console.log(this.anims[o])}, b5.Timeline.prototype.update = function(e) {
  var o = this.anims.length;
  if (0 === o && void 0 !== this.manager)return this.manager.remove(this),
  !0;
  this.playing=!1;
  for (var a = o-1;
    0 <= a;
    a--)this.anims[a].update(e) && (this.playing=!0);
  return this.playing
}, 'use strict', b5.TimelineManager = function(e) {
  this.timelines = [],
  this.parent = e,
  this.playing=!1
}, b5.TimelineManager.prototype.add = function(e) {
	e.manager = this,
  this.timelines.push(e);
  return e;
},
/*NEW: Parse from JSON*/
  b5.TimelineManager.prototype.parse = function(e) {
  	var t = JSON.parse(e);
  	for(var i in t) {
  		if(t[i].target == "*") var b = this.parent;
  		else for(var n = 0, a = t[i].target.split('.'), b = window, c = a.length; n < c; n++) b = b[a[n]];
  		var o = new b5.Timeline(b, t[i].property, t[i].frames, t[i].times, t[i].repeats, t[i].easing);
  		o.tween = t[i].tween,
  		o.name = i,
  		o.anims[0].destroy = t[i].destroy,
  		t[i].auto_play && o.anims[0].play();
  		this.add(o);
  	}
}, b5.TimelineManager.prototype.remove = function(e) {
  if (void 0 === e)return void(this.timelines = []);
  for (var o = this.timelines, a = o.length, n = 0;
    n < a;
    n++)if (o[n] === e)return void o.splice(n, 1)}, b5.TimelineManager.prototype.changeTarget = function(e) {
  for (var o = this.timelines, a = o.length, n = 0;
    n < a;
    n++)o[n].changeTarget(e)}, b5.TimelineManager.prototype.find = function(e) {
  for (var o = this.timelines, a = o.length, n = 0;
    n < a;
    n++)if (o[n].name === e)return o[n];
  return null
}, b5.TimelineManager.prototype.setRepeats = function(e) {
  for (var o = this.timelines, a = o.length, n = 0;
    n < a;
    n++)o[n].setRepeats(e)}, b5.TimelineManager.prototype.pause = function() {
  for (var e = this.timelines.length, o = 0;
    o < e;
    o++)this.timelines[o].pause()}, b5.TimelineManager.prototype.play = function() {
  for (var e = this.timelines.length, o = 0;
    o < e;
    o++)this.timelines[o].play()}, b5.TimelineManager.prototype.restart = function() {
  for (var e = this.timelines.length, o = 0;
    o < e;
    o++)this.timelines[o].restart()}, b5.TimelineManager.prototype.print = function() {
  for (var e = this.timelines.length, o = 0;
    o < e;
    o++)console.log(this.timelines[o])}, b5.TimelineManager.prototype.update = function(e) {
  var o = this.timelines.length;
  if (0 === o)return!1;
  this.playing=!1;
  for (var a = o-1;
    0 <= a;
    a--)this.timelines[a].update(e) && (this.playing=!0);
  return this.playing
}, 'use strict', b5.ActionsList = function(e, t) {
  this.repeats_left = t,
  this.manager = null,
  this.name = e,
  this.repeat = t,
  this.actions = [],
  this.current = 0,
  this.destroy=!0,
  this.playing=!1
}, b5.ActionsList.prototype.add = function(e) {
  return this.actions.push(e),
  e.parent = this,
  e
}, b5.ActionsList.prototype.remove = function(e) {
  for (var o = this.actions, a = o.length, n = 0;
    n < a;
    n++)if (o[n] === e)return void o.splice(n, 1)}, b5.ActionsList.prototype.execute = function() {
  if (!this.playing)return!0;
  var e = this.actions,
  t = e.length;
  if (0 === t)return!1;
  var o = e[this.current];
  return!0 !== o.initialised && (void 0 !== o.onInit && o.onInit(), o.initialised=!0),
  void 0 !== o.onTick && o.onTick() || (o.initialised=!1, this.current++, !(this.current >= t && (this.current = 0, 0 !== this.repeat && (this.repeats_left--, 0 >= this.repeats_left)))) || (this.playing=!1, this.repeats_left = this.repeat, !1)}, b5.ActionsList.prototype.pause = function() {
  this.playing=!1
}, b5.ActionsList.prototype.play = function() {
  this.playing=!0
}, b5.ActionsList.prototype.restart = function() {
  for (var e = this.actions, o = e.length, a = 0;
    a < o;
    a++)e[a].initialised=!1;
  this.repeats_left = this.repeat,
  this.play()}, b5.ActionsListManager = function() {
  this.actions = []}, b5.ActionsListManager.prototype.add = function(e) {
  return this.actions.push(e),
  e.manager = this,
  e
}, b5.ActionsListManager.prototype.remove = function(e) {
  for (var o = this.actions, a = o.length, n = 0;
    n < a;
    n++)if (o[n] === e)return void o.splice(n, 1)}, b5.ActionsListManager.prototype.find = function(e) {
  for (var o = this.actions, a = o.length, n = 0;
    n < a;
    n++)if (o[n].name === e)return o[n];
  return null
}, b5.ActionsListManager.prototype.execute = function() {
  for (var e = [], o = this.actions, a = o.length, n = 0;
    n < a;
    n++)o[n].execute() || o[n].destroy && e.push(o[n]);
  for (var n = 0;
    n < e.length;
    n++)this.remove(e[n])}, 'use strict', b5.EventsManager = function() {
  this.events = []}, b5.EventsManager.prototype.on = function(e, t, o) {
  this.events.push({
    name: e, func: t, data: o
  })}, b5.EventsManager.prototype.remove = function(e) {
  var t = this.events,
  o = t.length;
  this.events = array.filter(function(t) {
    return t.name !== e
  })}, b5.EventsManager.prototype.clear = function() {
  this.events = []}, b5.EventsManager.prototype.dispatch = function(e) {
  for (var o = this.events, a = o.length, n = 0;
    n < a;
    n++)if (o[n].name === e)return void o[n].func(o[n])}, 'use strict', b5.Task = function(e, t, o, a, n) {
  this.name = e,
  this.func = a,
  this.data = n,
  this.state = b5.Task.Stopped,
  this.running_time = 0,
  this.delay = t,
  this.loops = 0,
  this.repeat = o,
  this.last_time = 0,
  this.wait = 0,
  this.pause = function() {
    this.state = b5.Task.Paused
  },
  this.play = function() {
    this.state = b5.Task.Running
  },
  this.stop = function() {
    this.state = b5.Task.Stopped
  },
  0 === t?this.play(): this.state = b5.Task.Dormant
}, b5.Task.Dormant = 0, b5.Task.Running = 1, b5.Task.Paused = 2, b5.Task.Stopped = 3, b5.TasksQ = function() {
  this.q=!0,
  this.tasks = []}, b5.TasksQ.prototype.add = function(e, t, o, a, n) {
  var r = new b5.Task(e, t, o, a, n);
  return this.tasks.push(r),
  r
}, b5.TasksQ.prototype.removeAt = function(e) {
  this.tasks.splice(e, 1)}, b5.TasksQ.prototype.remove = function(e) {
  for (var o = this.tasks, a = o.length, n = 0;
    n < a;
    n++)if (o[n].name === e)return void o.splice(n, 1)}, b5.TasksQ.prototype.removeTask = function(e) {
  for (var o = this.tasks, a = o.length, n = 0;
    n < a;
    n++)if (o[n] === e)return void o.splice(n, 1)}, b5.TasksQ.prototype.find = function(e) {
  for (var o = this.tasks, a = o.length, n = 0;
    n < a;
    n++)if (o[n].name === e)return o[n];
  return null
}, b5.TasksQ.prototype.clear = function() {
  this.tasks = []}, b5.TasksQ.prototype.execute = function() {
  var e = b5.app.dt,
  t = this.tasks,
  o = t.length;
  if (0 === o)return 0;
  var a = t[0];
  if (a.state === b5.Task.Dormant && (a.running_time += e, a.running_time >= a.delay && (a.play(), a.running_time -= e)), a.state === b5.Task.Running) {
    var n=!0;
    0 !== a.wait && (a.last_time += e, a.last_time >= a.wait?a.last_time -= a.wait: n=!1),
    !0 == n && (a.func(a), a.running_time += e, 0 > a.delay?a.stop(): 0 < a.repeat && (a.loops++, a.loops >= a.repeat && (a.stop(), void 0 !== a.onComplete && a.onComplete(this), this.removeTask(a))))}return t.length
}, b5.TasksManager = function() {
  this.tasks = []}, b5.TasksManager.prototype.add = function(e, t, o, a, n) {
  var r = new b5.Task(e, t, o, a, n);
  return this.tasks.push(r),
  r
}, b5.TasksManager.prototype.removeAt = function(e) {
  this.tasks.splice(e, 1)}, b5.TasksManager.prototype.remove = function(e) {
  for (var o = this.tasks, a = o.length, n = 0;
    n < a;
    n++)if (o[n].name === e)return void o.splice(n, 1)}, b5.TasksManager.prototype.removeTask = function(e) {
  for (var o = this.tasks, a = o.length, n = 0;
    n < a;
    n++)if (o[n] === e)return void o.splice(n, 1)}, b5.TasksManager.prototype.find = function(e) {
  for (var o = this.tasks, a = o.length, n = 0;
    n < a;
    n++)if (o[n].name === e)return o[n];
  return null
}, b5.TasksManager.prototype.clear = function() {
  this.tasks = []}, b5.TasksManager.prototype.execute = function() {
  for (var e = [], o = b5.app.dt, a = this.tasks, n = a.length, r = 0, i;
    r < n;
    r++)if (i = a[r], i.q)0 === i.execute() && (void 0 !== i.onComplete && i.onComplete(this), e.push(i));
  else if (i.state === b5.Task.Dormant && (i.running_time += o, i.running_time >= i.delay && (i.play(), i.running_time -= o)), i.state === b5.Task.Running) {
    var s=!0;
    0 !== i.wait && (i.last_time += o, i.last_time >= i.wait?i.last_time -= i.wait: s=!1),
    s && (i.func(i), i.running_time += o, 0 > i.delay?i.stop(): 0 < i.repeat && (i.loops++, i.loops >= i.repeat && (e.push(i), i.stop(), void 0 !== i.onComplete && i.onComplete(this))))}for (var r = 0;
    r < e.length;
    r++)this.removeTask(e[r])}, 'use strict', b5.Actor = function(e) {
  this.type = b5.Actor.Type_Image,
  this.scene = null,
  this.parent = null,
  this.actors = [],
  this.removals = [],
  this.joints = [],
  this.timelines = new b5.TimelineManager(this),
  b5.ActionsListManager !== void 0 && (this.actions = new b5.ActionsListManager),
  this.tasks = new b5.TasksManager,
  this.frame_count = 0,
  this.accum_scale_x = 1,
  this.accum_scale_y = 1,
  this.accum_opacity = 1,
  this.body = null,
  this.transform = [],
  this.transform_dirty=!0,
  this.layout_dirty=!0,
  this.touch_et = null,
  this.touching=!1,
  this.hovering=!1,
  this.touchmove=!1,
  this.touch_pos = { x: 0, y: 0 },
  this.touch_drag_x = 0,
  this.touch_drag_y = 0,
  this.layer = 0,
  this.cache_canvas = null,
  this.name = '',
  this.tag = '',
  this.id=-1,
  this.active=!0,
  this.paused=!1,
  this.visible=!0,
  this.touchable=!1,
  this.hit=!0,
  this.touch_index = 0,
  this.x = 0,
  this.y = 0,
  this.x2 = 0,
  this.y2 = 0,
  this.w = 0,
  this.h = 0,
  this.ox = 0,
  this.oy = 0,
  //New (skew)
  this.skew_x = 0,
  this.skew_y = 0,
  //Userdata
  this.data = {},
  this.ignore_atlas_size=!1,
  this.absolute_origin=!0,
  this.rotation = 0,
  this.scale_x = 1,
  this.scale_y = 1,
  this.scale = 1,
  this.depth = 0,
  this.opacity = 1,
  this.smoothing = !0,
  //New
  this.filter = {
  /*
    blur: 0,
    brightness: 1,
    contrast: 1,
    grayscale: 0,
    hue: 0,
    invert: 0,
    saturate: 1,
    sepia: 0
  */
  },
  this.use_parent_opacity=!0,
  this.current_frame = 0,
  this.prev_frame = 0,
  this.frame_speed = 0,
  this.anim_frames = null,
  //Extra
  this.current_anim="",
  this.current_bitmap = 0,
  this.anim_ended = !1,
  //Bitmap atlas draw
  this.bitmap_sx = 0,
  this.bitmap_sy = 0,
  this.bitmap_sw = 0,
  this.bitmap_sh = 0,

  this.frames_repeat=!0,
  this.bitmap = null,
  this.atlas = null,
  this.vr = 0,
  this.vx = 0,
  this.vy = 0,
  this.vd = 0,
  this.vr_damping = 1,
  this.vx_damping = 1,
  this.vy_damping = 1,
  this.vd_damping = 1,
  this.ignore_camera=!1,
  this.wrap_position=!1,
  this.dock_x = 0,
  this.dock_y = 0,
  this.dock_screen=!1,
  this.margin = [0,
    0,
    0,
    0],
  this.bubbling=!1,
  this.clip_children=!1,
  this.clip_margin = [0,
    0,
    0,
    0],
  this.clip_shape = null,
  this.self_clip=!1,
  this.orphaned=!1,
  this.virtual=!1,
  this.stacking = 0,
  this.clip_virtual=!0,
  this.shadow=!1,
  this.shadow_x = 0,
  this.shadow_y = 0,
  this.shadow_blur = 0,
  this.shadow_colour = '#000000',
  this.composite_op = null,
  this.cache=!1,
  this.cached=!1,
  this.merge_cache=!1,
  this.round_pixels=!0,
  this.padding = 0,
  this.scale_method = 0,
  this.draw_reverse=!1,
  //Redraw
  this.redraw_count = 1,
  !0 === e && this.makeVirtual()}, b5.Actor.FitNone = 0, b5.Actor.FitPP = 1, b5.Actor.FitX = 2, b5.Actor.FitY = 3, b5.Actor.FitBest = 4, b5.Actor.FitAverage = 5, b5.Actor.FitGreatest = 6, b5.Actor.FitSmallest = 7, b5.Actor.FitSize = 8, b5.Actor.FitBest2 = 9, b5.Actor.Dock_None = 0, b5.Actor.Dock_Top = 1, b5.Actor.Dock_Bottom = 2, b5.Actor.Dock_Middle = 3, b5.Actor.Dock_Left = 1, b5.Actor.Dock_Right = 2, b5.Actor.Dock_Centre = 3, b5.Actor.Type_Image = 0, b5.Actor.Type_Label = 1, b5.Actor.Type_Rect = 2, b5.Actor.Type_Arc = 3, b5.Actor.Type_Polygon = 4, b5.Actor.Type_Particle = 5, b5.Actor.Type_Map = 6, b5.Actor.Stack_None = 0, b5.Actor.Stack_H = 1, b5.Actor.Stack_V = 2, Object.defineProperty(b5.Actor.prototype, '_x', {
    get: function() {
      return this.x
    }, set: function(e) {
      this.x !== e && (this.x = e, this.dirty())}}), Object.defineProperty(b5.Actor.prototype, '_y', {
    get: function() {
      return this.y
    }, set: function(e) {
      this.y !== e && (this.y = e, this.dirty())}}), Object.defineProperty(b5.Actor.prototype, '_x2', {
    get: function() {
      return this.x2
    }, set: function(e) {
      this.x2 !== e && (this.x2 = e, this.dirty())}}), Object.defineProperty(b5.Actor.prototype, '_y2', {
    get: function() {
      return this.y2
    }, set: function(e) {
      this.y2 !== e && (this.y2 = e, this.dirty())}}), Object.defineProperty(b5.Actor.prototype, '_ox', {
    get: function() {
      return this.ox
    }, set: function(e) {
      this.ox !== e && (this.ox = e, this.dirty())}}), Object.defineProperty(b5.Actor.prototype, '_oy', {
    get: function() {
      return this.oy
    }, set: function(e) {
      this.oy !== e && (this.oy = e, this.dirty())}}), Object.defineProperty(b5.Actor.prototype, '_rotation', {
    get: function() {
      return this.rotation
    }, set: function(e) {
      this.rotation !== e && (this.rotation = e, this.dirty())}}), Object.defineProperty(b5.Actor.prototype, '_scale_x', {
    get: function() {
      return this.scale_x
    }, set: function(e) {
      this.scale_x !== e && (this.scale_x = e, this.dirty())}}), Object.defineProperty(b5.Actor.prototype, '_scale_y', {
    get: function() {
      return this.scale_y
    }, set: function(e) {
      this.scale_y !== e && (this.scale_y = e, this.dirty())}}), Object.defineProperty(b5.Actor.prototype, '_scale', {
    get: function() {
    	return this.scale
    },
    set: function(e) {
      this.scale = e, this._scale_x = e, this._scale_y = e, this.dirty()}}), Object.defineProperty(b5.Actor.prototype, '_depth', {
    get: function() {
      return this.depth
    }, set: function(e) {
      this.depth !== e && (this.depth = e, this.dirty())}}), Object.defineProperty(b5.Actor.prototype, '_layer', {
    get: function() {
      return this.layer
    }, set: function(e) {
      this.layer !== e && (this.layer = e, null === this.parent?this.scene.order_changed=!0: this.parent.order_changed=!0)}}), Object.defineProperty(b5.Actor.prototype, '_atlas', {
    get: function() {
      return this.atlas
    }, set: function(e) {
      if (this.atlas !== e) {
        if (null === e)return void(this.atlas = null);
        this.atlas = b5.Utils.resolveResource(e, 'brush'),
        this.ignore_atlas_size || (this.ow = this.atlas.frames[0].w, this.oh = this.atlas.frames[0].h)}}}), Object.defineProperty(b5.Actor.prototype, '_bitmap', {
    get: function() {
      return this.bitmap
    },
    set: function(e) {
      this.bitmap !== e && (this.atlas = null, this.bitmap = b5.Utils.resolveResource(e, 'bitmap'))}}), Object.defineProperty(b5.Actor.prototype, '_clip_shape', {
    get: function() {
      return this.clip_shape
    },
    set: function(e) {
      this.clip_shape !== e && (this.clip_shape = b5.Utils.resolveResource(e, 'shape'))}}), Object.defineProperty(b5.Actor.prototype, '_av', {
    set: function(e) {
      this.onAVChanged !== void 0 && this.onAVChanged(e),
      this.visible = e,
      this.active = e,
      this.setBodyActive(this.active)}}), b5.Actor.prototype.setBodyActive = function(e) {
  null !== this.body && this.body.SetActive(e);
  for (var o = this.actors, a = o.length, n = 0;
    n < a;
    n++)o[n].setBodyActive(e)}, b5.Actor.prototype.setPosition = function(e, t) {
  if ((this.x !== e || this.y !== t) && (this.x = e, this.y = t, this.dirty(), null !== this.body)) {
    var o = Box2D.Common.Math.b2Vec2,
    a = this.scene.world_scale;
    this.body.SetPosition(new o(e/a, t/a))}}, b5.Actor.prototype.setPositionPhysics = function(e, t) {
  this.setPosition(e, t)}, b5.Actor.prototype.setSize = function(e, t) {(this.w !== e || this.h !== t) && (this.ignore_atlas_size=!0, this.w = e, this.h = t, this.dirty(), this.virtual && (this.layout_dirty=!0, this.Virtual_updateLayout(!0)))}, 
  b5.Actor.prototype.setOrigin = function(e, t) {
  	if(+t && +e) (this.ox !== e || this.oy !== t) && (this.ox = e, this.oy = t);
  	else {
  		this.ox = (-this.w/2) * (e == "center" ? 1 : e == "left" ? 0 : e == "right" && 2),
  		this.oy = (-this.h/2) * (t == "center" ? 1 : t == "top" ? 0 : t == "bottom" && 2);
  	}
  	this.dirty();
  }, b5.Actor.prototype.setScale = function(e, t) {(this.scale_x !== e || this.scale_y !== t) && (this.scale_x = e, this.scale_y = t, this.dirty())}, 
  //NEW 
  b5.Actor.prototype.setSkewing = function(e, t) {(this.skew_x !== e || this.skew_y !== t) && (this.skew_x = e, this.skew_y = t, this.dirty())},
  
  b5.Actor.prototype.setRotation = function(e) {
  this.rotation !== e && (this.rotation = e, this.dirty(), null !== this.body && this.body.SetAngle(e))}, b5.Actor.prototype.setRotationPhysics = function(e) {
  this.setRotation(e)}, b5.Actor.prototype.setDepth = function(e) {
  this.depth !== e && (this.depth = e, this.dirty())}, b5.Actor.prototype.playAnim = function(e, t, o) {
  if (this.active || (this._av=!0), null !== this.atlas) {
    var o = this.atlas.getAnim(e);
    null === o?this.app.debug && console.log('Warning: Could not find brush anim\''+e+'\' for actor \''+this.name+'\''): (this.current_frame = 0, this.current_bitmap = 0, this.anim_frames = o.indices, this.frame_speed = o.speed, this.frames_repeat = t, this.anim_ended = !1, this.dirty(), this.current_anim=e)}
 }, 
 b5.Actor.prototype.playAnimWithEnd = function(e, t) {
 	this.onAnimEnd = null;
	this.onAnimEnd = function() {
		t && t();
		this.onAnimEnd = null;
	};
	this.playAnim(e);
},
	b5.Actor.prototype.playTimeline = function(e, o) {
  var a = this.timelines.find(e);
  if (null !== a && (!this.active && (this._av=!0), a.restart(), a.update(0)), o)for (var n = this.actors, r = n.length, i = 0;
    i < r;
    i++)n[i].playTimeline(e, o);
  return a
}, b5.Actor.prototype.TweenTo = function(e, t, o, a, n, r) {
  !0 === n && this.timelines.remove();
  var i = new b5.Timeline(this, e, [this[e], t], [0, o], 1, [a || 0]);
  return void 0 !== r && i.setDelay(r),
  this.timelines.add(i),
  i
}, b5.Actor.prototype.TweenToWithEnd = function(e, t, o, a, n, r, i) {
  var s = this.TweenTo(e, t, o, a, n, r);
  return null != i && (s.anims[0].onEnd = i),
  s
}, b5.Actor.prototype.TweenToMany = function(e) {
  for (var o = 0;
    o < e.length;
    o++) {
    var a = e[o],
    n=!(0 !== o) && a.wipe;
    this.TweenToWithEnd(a.property, a.to, a.duration, a.easing, n, a.delay, a.onend)}
}, b5.Actor.prototype.TweenFrom = function(e, t, o, a, n) {
  !0 === n && this.timelines.remove();
  var r = new b5.Timeline(this, e, [t, this[e]], [0, o], 1, [a || 0]);
  return this.timelines.add(r),
  r
}, b5.Actor.prototype.TweenFromWithEnd = function(e, t, o, a, n, r) {
  var i = this.TweenFrom(e, t, o, a, n);
  return null != r && (i.anims[0].onEnd = r),
  i
}, b5.Actor.prototype.addTask = function(e, t, o, a, n) {
  this.tasks.add(e, t, o, a, n)}, b5.Actor.prototype.removeTask = function(e) {
  this.tasks.remove(e)
}, /*New*/
  b5.Actor.prototype.setTimeout = function(e,t) {
  	this.addTask(this.name+'.timeout', t, 1, e);
}, b5.Actor.prototype.release = function(t) {
  for (var e = 0;
    e < this.actors.length;
    e++)this.actors[e].release();
  this.onDestroy !== void 0 && this.onDestroy(),
  this.releaseJoints(),
  this.releaseBody(), t && this.destroy()}, b5.Actor.prototype.destroy = function() {
  null === this.parent?null !== this.scene && this.scene.removeActor(this): this.parent.removeActor(this)}, b5.Actor.prototype.changeParent = function(e) {
  var o = null === this.parent?this.scene.actors: this.parent.actors;
  for (var a = o.length, n = 0;
    n < a;
    n++)if (this === o[n]) {
    o.splice(n, 1),
    e.addActor(this);
    break
  }}, b5.Actor.prototype.addActor = function(e) {
  return null === this.scene && (this.scene = b5.app.focus_scene),
  this.actors.push(e),
  e.parent = this,
  e.scene = this.scene,
  this.layout_dirty=!0,
  e
}, b5.Actor.prototype.removeActor = function(e) {
  this.removals.push(e),
  this.layout_dirty=!0
}, b5.Actor.prototype.removeActorsWithTag = function(e) {
  for (var o = this.actors, a = o.length, n = 0, r = this.removals, i = 0;
    i < a;
    i++)o[i].tag === e && (r.push(o[i]), n++);
  return this.layout_dirty=!0,
  n
}, b5.Actor.prototype.removeAllActors = function() {
  for (var e = this.actors, o = e.length, a = this.removals, n = 0;
    n < o;
    n++)a.push(e[n]);
  this.layout_dirty=!0
}, b5.Actor.prototype.cleanupDestroyedActors = function() {
  var e = this.removals.length;
  if (0 < e)for (var o = this.removals, a = this.actors, n = a.length, r = 0, i;
    r < e;
    r++) {
    i = o[r];
    for (var c = 0;
      c < n;
      c++)if (i === a[c]) {
      i.release(),
      a.splice(c, 1),
      n--;
      break
    }}this.removals = []}, b5.Actor.prototype.findActor = function(e, o) {
  o === void 0 && (o=!1);
  for (var a = this.actors, n = a.length, r = 0;
    r < n;
    r++) {
    if (a[r].name === e)return a[r];
    if (o) {
      var i = a[r].findActor(e, o);
      if (null !== i)return i
    }}return null
}, b5.Actor.prototype.findActorById = function(e, o) {
  o === void 0 && (o=!1);
  for (var a = this.actors, n = a.length, r = 0;
    r < n;
    r++) {
    if (a[r].id === e)return a[r];
    if (o) {
      var i = a[r].findActorById(e, o);
      if (null !== i)return i
    }}return null
}, 
b5.Actor.prototype.findActorsByTagName = function(e, t) {
	t === void 0 && (t!=1);
  for (var a = this.actors, n = a.length, r = 0, o = [];
    r < n;
    r++){
    if (a[r].tag === e) o.push(a[r]);
    if(t) {
    	var s = a[r]?a[r].findActorsByTagName(e,t):null;
    	if(s) for(var c=0;c<s.length;c++)o.push(s[c]);
    }}
    return o;
},b5.Actor.prototype.findFirstParent = function() {
  for (var e = this;
    null !== e;
  ) {
    if (null === e.parent)return e;
    e = e.parent
  }return null
}, b5.Actor.prototype.findFirstCachedParent = function() {
  for (var e = this.parent;
    null !== e;
  ) {
    if (null !== e.cache_canvas)return e;
    e = e.parent
  }return null
}, b5.Actor.prototype.updateParentTransforms = function() {
  for (var e = [], o = this;
    null !== o;
  )e.push(o),
  o = o.parent;
  for (var a = e.length-1;
    0 <= a;
    a--)e[a].updateTransform()
}, 
  b5.Actor.prototype.getShapeType = function() {
  	switch(this.type) {
  		case b5.Actor.Type_Rect:
  		case b5.Actor.Type_Image:
  			return b5.Shape.TypeBox;
  		case b5.Actor.Type_Arc:
  			return b5.Shape.TypeCircle;
  		case b5.Actor.Type_Map:
  			return b5.Shape.TypeBox;
  		case b5.Actor.Type_Polygon:
  			return b5.Shape.TypePolygon;
  	}
}, b5.Actor.prototype.getSlot = function() {
  var e = null === this.parent?this.scene.actors: this.parent.actors;
  for (var o = e.length, a = 0;
    a < o;
    a++)if (e[a] === this)return a
}, b5.Actor.prototype.moveToSlot = function(e) {
  var t = null === this.parent?this.scene.actors: this.parent.actors;
  var o = this.getSlot();
  o === e || (t.splice(e, 0, this), e < o && o++, t.splice(o, 1))}, b5.Actor.prototype.bringToFront = function() {
  var e = null === this.parent?this.scene.actors: this.parent.actors;
  for (var o = e.length, a=-1, n = 0;
    n < o;
    n++)if (e[n] === this) {
    a = n;
    break
  }0 <= a && (e.splice(a, 1), e.push(this))}, b5.Actor.prototype.sendToBack = function() {
  var e = null === this.parent?this.scene.actors: this.parent.actors;
  for (var o = e.length, a=-1, n = 0;
    n < o;
    n++)if (e[n] === this) {
    a = n;
    break
  }0 <= a && (e.splice(a, 1), e.unshift(this))}, b5.Actor.prototype.onBeginTouchBase = function(e,t) {
  this.touching=!0,
  this.bubbling && null !== this.parent && this.parent.onBeginTouchBase(e,t),
  this.onBeginTouch !== void 0 && this.onBeginTouch(e,t)}, b5.Actor.prototype.onEndTouchBase = function(e,t) {
  if (this.touching && void 0 !== this.onTapped && (this.onTapped(e,t), void 0 !== this.onDblTapped))if (null === this.touch_et)this.touch_et = Date.now();
  else {
    var t = Date.now(),
    o = t-this.touch_et;
    500 > o && this.onDblTapped(e),
    this.touch_et = t
  }this.touching=!1,
  this.touchmove=!1,
  this.bubbling && null !== this.parent && this.parent.onEndTouchBase(e,t),
  this.onEndTouch !== void 0 && this.onEndTouch(e,t)}, b5.Actor.prototype.onMoveTouchBase = function(e,p,a) {
  this.touching && (this.touchmove=!0),
  this.bubbling && null !== this.parent && this.parent.onMoveTouchBase(e,p,a),
  this.virtual && this.Virtual_onMoveTouch(e,p,a),
  this.onMoveTouch !== void 0 && this.onMoveTouch(e,p,a)}, b5.Actor.prototype.releaseBody = function() {
  null !== this.body && (this.scene.world.DestroyBody(this.body), this.body = null)}, b5.Actor.prototype.releaseJoints = function() {
  if (null !== this.body) {
    for (var e = 0;
      e < this.joints.length;
      e++)this.scene.world.DestroyJoint(this.joints[e]);
    this.joints = []
  }}, b5.Actor.prototype.initBody = function(e, t, o) {
  if (!this.scene.app.box2d)return null;
  var a = this.scene,
  n = new Box2D.Dynamics.b2BodyDef,
  r = a.world_scale;
  return n.type = 'static' === e?Box2D.Dynamics.b2Body.b2_staticBody: 'kinematic' === e?Box2D.Dynamics.b2Body.b2_kinematicBody: Box2D.Dynamics.b2Body.b2_dynamicBody,
  n.position.Set(this.x/r, this.y/r),
  n.angle = this.rotation,
  n.fixedRotation = t,
  n.bullet = o,
  this.body = a.world.CreateBody(n),
  this.body.SetUserData(this),
  this.body
}, b5.Actor.prototype.addFixture = function(e) {
  if (null === this.body)return null;
  var o = e,
  a = e,
  n;
  void 0 !== e.shape && (o = e.shape),
  void 0 !== e.material && (a = e.material);
  var r = this.scene.world_scale,
  i = this.scale_x,
  c = this.scale_y,
  d = Box2D.Common.Math.b2Vec2;
  if (o.type === b5.Shape.TypeBox) {
    n = new Box2D.Dynamics.b2FixtureDef,
    n.shape = new Box2D.Collision.Shapes.b2PolygonShape;
    var p = o.width/(2*r)*i,
    l = o.height/(2*r)*c;
    n.shape.SetAsOrientedBox(p, l, new d(o.width/r*this.ox, o.height/r*this.oy), 0)} else if (o.type === b5.Shape.TypeCircle)n = new Box2D.Dynamics.b2FixtureDef,
  n.shape = new Box2D.Collision.Shapes.b2CircleShape(o.width/r*i);
  else if (o.type === b5.Shape.TypePolygon) {
    if (void 0 !== o.convexVertices && 0 < o.convexVertices.length) {
      for (var y = [], _ = o.convexVertices.length, u = 0;
        u < _;
        u++) {
        n = new Box2D.Dynamics.b2FixtureDef,
        n.shape = new Box2D.Collision.Shapes.b2PolygonShape;
        for (var h = o.convexVertices[u], g = [], m = h.length, f = 0;
          f < m;
          f += 2)g.push({
            x: h[f]/r*i, y: h[f+1]/r*c
          });
        n.shape.SetAsArray(g, g.length),
        void 0 !== a.density && (n.density = a.density),
        void 0 !== a.friction && (n.friction = a.friction),
        void 0 !== a.restitution && (n.restitution = a.restitution),
        void 0 !== e.is_sensor && (n.isSensor = e.is_sensor),
        void 0 !== e.collision_category && (n.filter.categoryBits = e.collision_category),
        void 0 !== e.collision_mask && (n.filter.maskBits = e.collision_mask),
        void 0 !== e.collision_group && (n.filter.groupIndex = e.collision_group),
        y.push(this.body.CreateFixture(n))}return y
    }n = new Box2D.Dynamics.b2FixtureDef,
    n.shape = new Box2D.Collision.Shapes.b2PolygonShape;
    for (var h = o.vertices, g = [], m = h.length, f = 0;
      f < m;
      f += 2)g.push({
        x: h[f]/r*i, y: h[f+1]/r*c
      });
    n.shape.SetAsArray(g, g.length)}return void 0 !== a.density && (n.density = a.density),
  void 0 !== a.friction && (n.friction = a.friction),
  void 0 !== a.restitution && (n.restitution = a.restitution),
  void 0 !== a.is_sensor && (n.isSensor = a.is_sensor),
  void 0 !== e.collision_category && (n.filter.categoryBits = e.collision_category),
  void 0 !== e.collision_mask && (n.filter.maskBits = e.collision_mask),
  void 0 !== e.collision_group && (n.filter.groupIndex = e.collision_group),
  this.body.CreateFixture(n),
  this._fixture = e
}, b5.Actor.prototype.removeFixture = function() {
  if (null === this.body)return null;
  this.body.DestroyFixture(this.body.GetFixtureList());
},
b5.Actor.prototype.setFixture = function(e) {
	this.removeFixture();
	if(e) for(var i in e) this._fixture[i] = e[i];
	this.addFixture(this._fixture);
},
b5.Actor.prototype.setBodyType = function(e) {
	if (null === this.body)return null;
	this.body.SetType('static' === e?Box2D.Dynamics.b2Body.b2_staticBody: 'kinematic' === e?Box2D.Dynamics.b2Body.b2_kinematicBody: Box2D.Dynamics.b2Body.b2_dynamicBody);
},
b5.Actor.prototype.addJoint = function(e) {
  var t = Math.PI;
  if (null === this.body)return null;
  var o = this.scene,
  a = o.world,
  n = o.world_scale,
  r = Box2D.Common.Math.b2Vec2,
  i = this.body,
  s = e.actor_b.body,
  c = i.GetWorldCenter(),
  d = s.GetWorldCenter(),
  p = new r(c.x, c.y),
  l;
  p.x += e.anchor_a.x/n,
  p.y += e.anchor_a.y/n;
  var y = new r(d.x, d.y);
  if (y.x += e.anchor_b.x/n, y.y += e.anchor_b.y/n, 'weld' === e.type)l = new Box2D.Dynamics.Joints.b2WeldJointDef,
  l.Initialize(i, s, p),
  l.collideConnected = e.self_collide;
  else if ('distance' === e.type)l = new Box2D.Dynamics.Joints.b2DistanceJointDef,
  l.Initialize(i, s, p, y),
  l.collideConnected = e.self_collide,
  l.frequencyHz = e.frequency,
  l.dampingRatio = e.damping;
  else if ('revolute' === e.type)l = new Box2D.Dynamics.Joints.b2RevoluteJointDef,
  l.Initialize(i, s, p),
  l.collideConnected = e.self_collide,
  e.limit_joint && (l.enableLimit=!0, l.lowerAngle = e.lower_limit*(t/180), l.upperAngle = e.upper_limit*(t/180)),
  e.motor_enabled && (l.enableMotor=!0, l.motorSpeed = e.motor_speed, l.maxMotorTorque = e.max_motor_torque);
  else if ('prismatic' === e.type)l = new Box2D.Dynamics.Joints.b2PrismaticJointDef,
  l.Initialize(i, s, p, new r(e.axis.x, e.axis.y)),
  l.collideConnected = e.self_collide,
  e.limit_joint && (l.enableLimit=!0, l.lowerTranslation = e.lower_limit/n, l.upperTranslation = e.upper_limit/n),
  e.motor_enabled && (l.enableMotor=!0, l.motorSpeed = e.motor_speed, l.maxMotorForce = e.max_motor_force);
  else if ('pulley' === e.type) {
    var _ = new r(c.x, c.y);
    _.x += e.ground_a.x/n,
    _.y += e.ground_a.y/n;
    var u = new r(d.x, d.y);
    u.x += e.ground_b.x/n,
    u.y += e.ground_b.y/n,
    l = new Box2D.Dynamics.Joints.b2PulleyJointDef,
    l.Initialize(i, s, _, u, p, y, e.ratio),
    l.collideConnected = e.self_collide
  } else 'wheel' === e.type?(l = new Box2D.Dynamics.Joints.b2LineJointDef, l.Initialize(i, s, p, e.axis), l.collideConnected = e.self_collide, e.limit_joint && (l.enableLimit=!0, l.lowerTranslation = e.lower_limit/n, l.upperTranslation = e.upper_limit/n), e.motor_enabled && (l.enableMotor=!0, l.motorSpeed = e.motor_speed, l.maxMotorForce = e.max_motor_force)): 'mouse' === e.type && (l = new Box2D.Dynamics.Joints.b2MouseJointDef, l.collideConnected = e.self_collide, l.bodyA = i, l.bodyB = s, l.collideConnected = e.self_collide, l.maxForce = e.max_motor_force, l.dampingRatio = e.damping);
  var h = a.CreateJoint(l);
  return this.joints.push(h),
  h
}, b5.Actor.prototype.removeJoint = function(e) {
  for (var o = this.joints, a = o.length, n = 0;
    n < a;
    n++)if (o[n] === e)return this.scene.world.DestroyJoint(e),
  void o.splice(n, 1)}, b5.Actor.prototype.getScaleFromMethod = function(e) {
  var t = b5.app,
  o = t.global_scale,
  a = t.global_scale;
  if (!t.disable_dock_screen) {
    var n = e;
    if (n !== b5.Actor.FitNone) {
      var r = 1/t.canvas_scale,
      i = t.inner_width/t.design_width*r,
      s = t.inner_height/t.design_height*r;
      if (n === b5.Actor.FitBest)i > s?(o *= i, a *= i): (o *= s, a *= s);
      else if (n === b5.Actor.FitBest2)i < s?(o *= i, a *= i): (o *= s, a *= s);
      else if (n === b5.Actor.FitX)o *= i,
      a *= i;
      else if (n === b5.Actor.FitY)o *= s,
      a *= s;
      else if (n === b5.Actor.FitAverage) {
        var c = .5*(i+s);
        o *= c,
        a *= c
      } else if (n === b5.Actor.FitGreatest) {
        var c;
        c = t.inner_width > t.inner_height?i: s,
        o *= c,
        a *= c
      } else if (n === b5.Actor.FitSmallest) {
        var c;
        c = t.inner_width < t.inner_height?i: s,
        o *= c,
        a *= c
      } else n === b5.Actor.FitSize?(o *= i, a *= s): n === b5.Actor.FitPP && (o *= r, a *= r)}}return {
    x: o,
    y: a
  }}, b5.Actor.prototype.updateTransform = function() {
  if (this.transform_dirty) {
    var e = this.transform,
    t = this.scene,
    o = this.rotation,
    a = this.scale_x,
    n = this.scale_y,
    r = this.x+this.x2,
    i = this.y+this.y2;
    null === this.parent && (a *= t.scale, n *= t.scale);
    var c = this.scale_method;
    if (0 !== c) {
      var d = this.getScaleFromMethod(c);
      a *= d.x,
      n *= d.y
    }var s = this.parent;
    null === s || this.orphaned?(this.accum_scale_x = a, this.accum_scale_y = n): (this.accum_scale_x = a*s.accum_scale_x, this.accum_scale_y = n*s.accum_scale_y);
    var p = Math.cos(o),
    l = Math.sin(o);
    if (0 !== this.depth && 1 !== this.depth) {
      var y = 1/this.depth;
      a *= y,
      n *= y,
      e[4] = (r-t.camera_x)*y,
      e[5] = (i-t.camera_y)*y
    } else this.transform_dirty=!1,
    e[4] = r,
    e[5] = i;
    e[0] = p*a,
    //Transform add skew variables
    e[1] = (l*a) + this.skew_y,
    e[2]= (-l*n) + this.skew_x,
    e[3] = p*n;
    var _ = null,
    u = this.atlas;
    null !== u && (null === this.anim_frames?_ = u.getFrame(0|this.current_frame): _ = u.getFrame(this.anim_frames[0|this.current_frame]));
    var h = this.ox,
    g = this.oy;
    (0 !== h || 0 !== g || null !== _) && (!this.absolute_origin && (h *= this.ow, g *= this.oh), null !== _ && (h -= _.ox, g -= _.oy), e[4] += h*e[0]+g*e[2], e[5] += h*e[1]+g*e[3]),
    null === s || this.orphaned || b5.Maths.mulMatrix(e, s.transform)}}, b5.Actor.prototype.drawChildren = function(e) {this.onChildrenDrawStart && this.onChildrenDrawStart();
  var o = this.actors.length,
  a = 0;
  if (0 < o) {
    var n = this.actors;
    if (this.draw_reverse)for (var r = o-1, i;
      0 <= r;
      r--)i = n[r].layer,
    e?0 <= i && (n[r].draw(), a++): 0 > i && (n[r].draw(), a++);
    else for (var r = 0, i;
      r < o;
      r++)i = n[r].layer,
    e?0 <= i && (n[r].draw(), a++): 0 > i && (n[r].draw(), a++);
  }
  this.onChildrenDrawEnd && this.onChildrenDrawEnd();
  return a === o}, b5.Actor.prototype.draw = function() {
  if (this.visible && this.opacity) {
    if (this.cache && (this.drawToCache(), this.cache=!1), this.merge_cache)return this.drawChildren(!1),
    void this.drawChildren(!0);
    //New: Multiple draw per frame
    for(var v=0;v<this.redraw_count;v++){
    this.onRedraw && this.onRedraw(v+1);
    this.onMode7Redraw && this.onMode7Redraw(v+1);
    var e = this.cache_canvas,
    t = this.scene,
    o = t.app,
    a = o.canvas_scale,
    n = o.display,
    r = b5.app.pixel_ratio;
    null === e && (r = 1);
    var i = null;
    if (null === e) {
      var s = this.atlas;
      null !== s && (i = null === this.anim_frames?s.getFrame(0|this.current_frame): s.getFrame(this.anim_frames[0|this.current_frame]), !this.ignore_atlas_size && (this.w = i.w, this.h = i.h), (0|this.prev_frame) != (0|this.current_frame) && this.dirty(), this.prev_frame = this.current_frame)}var c = o.canvas_cx+t.x*a/r,
    d = o.canvas_cy+t.y*a/r;
    (void 0 === this.ow || this.center_atlas) && (this.ow = this.w, this.oh = this.h);
    var p = this.ow/2,
    l = this.oh/2;
    this.ignore_camera || 0 !== this.depth && 1 !== this.depth || (c -= t.camera_x*a, d -= t.camera_y*a),
    this.updateTransform();
    var y = this.drawChildren(!1);
    this.current_bitmap = i !== null ? i.bitmap : 0;
    this.preDraw();
    var _ = this.self_clip,
    u = this.clip_children,
    h = this.transform,
    g = h[4]*a+c,
    m = h[5]*a+d,
    //Bitmap atlas draw
    q = this.bitmap_sw,
    w = this.bitmap_sh,
    x;
    this.round_pixels && (p = 0|p+.5, l = 0|l+.5, g = 0|g+.5, m = 0|m+.5),
    n.setTransform(h[0]*a, h[1]*a, h[2]*a, h[3]*a, g, m),
    _ && this.setClipping(0, 0),
    this.onDraw && this.onDraw(n),
    null === e?null === s?null !== this.bitmap && ( x = this.bitmap,
      n.drawAtlasImage(x.image, this.bitmap_sx, this.bitmap_sy, 
        q<1?x.image.width-this.bitmap_sx:q, 
        w<1?x.image.height-this.bitmap_sy:w, -p, -l, this.w, this.h)) : 
      s.bitmaps[this.current_bitmap] && n.drawAtlasImage(s.bitmaps[this.current_bitmap].image, i.x, i.y, i.w, i.h, -p, -l, this.w+1, this.h+1): n.drawImage(e, -e.width>>1, -e.height>>1),
    this.postDraw(),
    u?!_ && this.setClipping(-p, -l): _ && n.restoreContext(),
    y || this.drawChildren(!0),
    u && n.restoreContext()}
  }
  }, b5.Actor.prototype.enableCache = function(e) {
  this.cache=!0,
  this.cached=!0,
  this.merge_cache = e
}, b5.Actor.prototype.resetCache = function() {
  if (this.cached) {
    this.cache=!0;
    var e = this.actors.length;
    if (0 < e)for (var o = this.actors, a = 0;
      a < e;
      a++)o[a].resetCache()}}, b5.Actor.prototype.drawToCache = function() {
  var e = b5.app.display,
  t = null,
  o = null;
  if (this.merge_cache) {
    var o = this.findFirstCachedParent();
    null !== o && (t = o.cache_canvas)}var a = null,
  n = this.atlas;
  null !== n && (null === this.anim_frames?a = n.getFrame(this.current_frame<<0): a = n.getFrame(this.anim_frames[this.current_frame<<0]));
  var i = b5.app.pixel_ratio;
  null === t && (t = e.createCache(), t.width = 0|this.ow*i, t.height = 0|this.oh*i),
  e.setCache(t);
  var s = this.ow/2,
  c = this.oh/2,
  d = this.scene,
  p = [],
  l = this.rotation,
  r = Math.cos(l),
  y = Math.sin(l),
  _ = 1/i,
  u = this.scale_x,
  h = this.scale_y;
  p[0] = r*u,
  p[1] = y*u,
  p[2]=-y*h,
  p[3] = r*h,
  p[4] = this.x+t.width/2-this.ox*this.ow,
  p[5] = this.y+t.height/2-this.oy*this.oh;
  var g = [1,
    0,
    0,
    1,
    this.ox*this.ow,
    this.oy*this.oh];
  b5.Maths.preMulMatrix(p, g),
  this.self_clip && (e.setTransform(1, 0, 0, 1, 0, 0), this.setClipping(p[4], p[5])),
  this.preDrawCached(),
  e.setTransform(p[0]*_, p[1]*_, p[2]*_, p[3]*_, p[4], p[5]),
  null === n?null !== this.bitmap && e.drawImage(this.bitmap.image, -s, -c, this.w, this.h): e.drawAtlasImage(n.bitmaps[a.bitmap], a.x, a.y, a.w, a.h, -s, -c, this.w, this.h),
  this.postDrawCached(),
  this.self_clip && e.restoreContext(),
  e.setCache(null),
  this.cached&&!this.merge_cache && (this.cache_canvas = t)},
  //NEW, on Rendering functions
  /*
  b5.Actor.prototype.onPreDraw
  b5.Actor.prototype.onPostDraw
  b5.Actor.prototype.onRedraw
  */
  
  b5.Actor.prototype.preDraw = function() {
  var e = b5.app.display;
  //More rendering options, by AndrewDev
  /**/
  e.setSmoothing(this.smoothing&&b5.app.canvas_smoothing);
  
  e.filter(this.filter);
  //Function to access rendering
  this.onPreDraw&&this.onPreDraw(e);
  /**/
  this.accum_opacity = null !== this.parent && this.use_parent_opacity?this.parent.accum_opacity*this.opacity: this.opacity*this.scene.opacity,
  //There was an issue where only actors with a bitmap attached can use opacity, so polygons, rects and arcs were always visible
  //This is a check that prevents non image actors to use alpha, this line was in the original Booty5 code, and i still don't know why. I've so much trouble with this and now i found it.
//  this.type === b5.Actor.Type_Image? e.setGlobalAlpha(this.accum_opacity),//: e.setGlobalAlpha(1),
  //GLOBAL ALPHA FIX
  e.setGlobalAlpha(b5.Maths.cap(this.accum_opacity,0,1)),
  this.shadow && e.setShadow(this.shadow_x, this.shadow_y, this.shadow_colour, this.shadow_blur),
  null !== this.composite_op && e.setGlobalCompositeOp(this.composite_op)}, b5.Actor.prototype.postDraw = function() {
  var e = b5.app.display;
  
  //Reset context filters for the next actor to draw
  /**/
   e.setSmoothing(b5.app.canvas_smoothing);
   e.context.filter="none";
    //Function to access rendering
  this.onPostDraw&&this.onPostDraw(e);
  /**/
  
  this.shadow && e.setShadowOff(),
  null !== this.composite_op && e.setGlobalCompositeOp('source-over')}, b5.Actor.prototype.preDrawCached = function() {
  var e = b5.app.display;
  this.shadow && e.setShadow(this.shadow_x, this.shadow_y, this.shadow_colour, this.shadow_blur),
  null !== this.composite_op && e.setGlobalCompositeOp(this.composite_op)}, b5.Actor.prototype.postDrawCached = function() {
  var e = b5.app.display;
  this.shadow && e.setShadowOff(),
  null !== this.composite_op && e.setGlobalCompositeOp('source-over')}, b5.Actor.prototype.baseUpdate = function(e) {
  if (this.active) {
    void 0 !== this.onTick && this.onTick(e),
    this.timelines.update(e),
    void 0 !== this.actions && this.actions.execute(),
    this.tasks.execute(),
    this.virtual && this.Virtual_update(e);
    var o = this.scene;
    if (null !== this.atlas) {
      this.current_frame += this.frame_speed*e;
      var a;
      if (a = null === this.anim_frames?this.atlas.getMaxFrames(): this.anim_frames.length, !this.frames_repeat)this.current_frame >= a?(this.current_frame = a-1, null != this.onAnimEnd && !this.anim_ended && (this.anim_ended = !0, this.onAnimEnd(this.current_anim))): 0 > this.current_frame && (null !== this.onAnimEnd && this.onAnimEnd(), this.current_frame = 0);
      else if (0 > this.current_frame)for (;
        0 > this.current_frame;
      ){this.current_frame += a; void 0 !== this.onAnimRepeat && this.onAnimRepeat()}
      else for (;
        this.current_frame >= a;
      ){this.current_frame -= a; void 0 !== this.onAnimRepeat && this.onAnimRepeat()}
    }var n = this.x,
    r = this.y,
    i = this.body;
    if (null !== i) {
      var c = i.GetPosition(),
      d = o.world_scale;
      this.setRotation(i.GetAngle()),
      this.setPosition(c.x*d, c.y*d)} else this.rotation += this.vr*e,
    this.vr *= this.vr_damping,
    this.x += this.vx*e,
    this.vx *= this.vx_damping,
    this.y += this.vy*e,
    this.vy *= this.vy_damping;
    if (0 !== this.vd && (this.depth += this.vd*e, this.vd *= this.vd_damping), this.wrap_position) {
      var p = o.extents[0],
      l = p+o.extents[2],
      y = o.extents[1],
      _ = y+o.extents[3];
      this.x < p?this.x = l: this.x > l && (this.x = p),
      this.y < y?this.y = _: this.y > _ && (this.y = y)}if (null === this.parent||!this.parent.virtual)if (this.dock_screen&&!b5.app.disable_dock_screen) {
      var u = this.scale_method,
      h = 1,
      g = 1;
      if (0 !== u) {
        var m = this.getScaleFromMethod(u);
        h = m.x,
        g = m.y
      }if (0 !== this.dock_x) {
        var m = this.getScaleFromMethod(2);
        this.dock_x === b5.Actor.Dock_Left?this.x=-o.w*m.x/2+(this.w+2*this.margin[0])*this.scale_x*h/2: this.dock_x === b5.Actor.Dock_Right?this.x = o.w*m.x/2-(this.w+2*this.margin[1])*this.scale_x*h/2: this.dock_x === b5.Actor.Dock_Centre && (this.x = (this.w+2*this.margin[0])*this.scale_x*h/2)}if (0 !== this.dock_y) {
        var m = this.getScaleFromMethod(3);
        this.dock_y === b5.Actor.Dock_Top?this.y=-o.h*m.y/2+(this.h+2*this.margin[2])*this.scale_y*g/2: this.dock_y === b5.Actor.Dock_Bottom?this.y = o.h*m.y/2-(this.h+2*this.margin[3])*this.scale_y*g/2: this.dock_y === b5.Actor.Dock_Middle && (this.y = (this.h+2*this.margin[2])*this.scale_y*g/2)}} else 0 !== this.dock_x && (this.dock_x === b5.Actor.Dock_Left?this.x=-o.w/2+this.w*this.scale_x/2+this.margin[0]: this.dock_x === b5.Actor.Dock_Right?this.x = o.w/2-this.w*this.scale_x/2+this.margin[1]: this.dock_x === b5.Actor.Dock_Centre && (this.x = this.w*this.scale_x/2+this.margin[0])),
    0 !== this.dock_y && (this.dock_y === b5.Actor.Dock_Top?this.y=-o.h/2+this.h*this.scale_y/2+this.margin[2]: this.dock_y === b5.Actor.Dock_Bottom?this.y = o.h/2-this.h*this.scale_y/2+this.margin[3]: this.dock_y === b5.Actor.Dock_Middle && (this.y = this.h*this.scale_y/2+this.margin[2]));
    (this.x !== n || this.y !== r || null === i && 0 !== this.vr) && this.dirty();
    var f = this.actors.length;
    if (0 < f)for (var A = this.actors, x = 0;
      x < f;
      x++)A[x].update(e);
    this.cleanupDestroyedActors(),
    this.order_changed && (this.order_changed=!1, b5.Utils.sortLayers(this.actors)),
    this.frame_count++
  }}, b5.Actor.prototype.update = function(e) {
  this.baseUpdate(e)}, b5.Actor.prototype.updateToPhysics = function() {
  if (null !== this.body) {
    var e = Box2D.Common.Math.b2Vec2;
    this.body.SetLinearVelocity(new e(this.vx, this.vy)),
    this.body.SetAngularVelocity(this.vr),
    this.body.SetAwake(!0)}}, b5.Actor.prototype.dirty = function() {
  this.transform_dirty=!0;
  for (var e = this.actors, o = e.length, a = 0;
    a < o;
    a++)e[a].dirty()}, b5.Actor.prototype.makeVirtual = function() {
  this.prev_scroll_pos_x = 0,
  this.prev_scroll_pos_y = 0,
  this.scroll_pos_x = 0,
  this.scroll_pos_y = 0,
  this.scroll_vx = 0,
  this.scroll_vy = 0,
  this.scroll_range = [0,
    0,
    0,
    0],
  this.virtual=!0
}, b5.Actor.prototype.Virtual_onMoveTouch = function() {
  if (this.touching && (0 !== this.scroll_range[2] || 0 !== this.scroll_range[3])) {
    var e = this.scene.app;
    this.prev_scroll_pos_x = this.scroll_pos_x,
    this.prev_scroll_pos_y = this.scroll_pos_y,
    this.scroll_vx = e.touch_drag_x,
    this.scroll_pos_x += e.touch_drag_x,
    this.scroll_vy = e.touch_drag_y,
    this.scroll_pos_y += e.touch_drag_y,
    (0 !== this.scroll_vx || 0 !== this.scroll_vy) && (this.Virtual_scrollRangeCheck(), this.layout_dirty=!0, this.Virtual_updateLayout())}}, b5.Actor.prototype.Virtual_update = function() {
  this.touching || (this.prev_scroll_pos_x = this.scroll_pos_x, this.prev_scroll_pos_y = this.scroll_pos_y, this.scroll_pos_x += this.scroll_vx, this.scroll_pos_y += this.scroll_vy, (0 !== this.scroll_vx || 0 !== this.scroll_vy) && (this.Virtual_scrollRangeCheck(), this.layout_dirty=!0, this.Virtual_updateLayout()), this.scroll_vx *= .9, this.scroll_vy *= .9, -.5 < this.scroll_vx && .5 > this.scroll_vx && (this.scroll_vx = 0), -.5 < this.scroll_vy && .5 > this.scroll_vy && (this.scroll_vy = 0))}, b5.Actor.prototype.Virtual_scrollRangeCheck = function() {
  var e = this.scroll_pos_x,
  t = this.scroll_pos_y,
  o=-this.scroll_range[0],
  a = o-this.scroll_range[2],
  n=-this.scroll_range[1],
  r = n-this.scroll_range[3];
  e < a?(e = a, this.scroll_vx = 0): e > o && (e = o, this.scroll_vx = 0),
  t < r?(t = r, this.scroll_vy = 0): t > n && (t = n, this.scroll_vy = 0),
  this.scroll_pos_x = e,
  this.scroll_pos_y = t
}, b5.Actor.prototype.Virtual_clipLayout = function(e, t, o) {
  var a = Math.abs;
  if (this.clip_virtual) {
    var n = e.w/2,
    r = e.h/2;
    e._av=!(e.y<-o-r || e.y > o+r || e.x<-t-n || e.x > t+n)}( 1 < a(this.scroll_vx) || 1 < a(this.scroll_vy)) && (e.touching=!1),
  e.dirty()}, b5.Actor.prototype.Virtual_updateLayout = function(e) {
  if (this.layout_dirty) {
    this.layout_dirty=!1;
    var o = this.prev_scroll_pos_x-this.scroll_pos_x,
    n = this.prev_scroll_pos_y-this.scroll_pos_y,
    r = this.actors.length,
    i = this.w*this.scale_x/2,
    s = this.h*this.scale_y/2;
    if (0 < r) {
      var c = this.stacking,
      d = this.actors,
      p;
      if (c === b5.Actor.Stack_None)for (var l = 0;
        l < r;
        l++)p = d[l],
      0 === p.dock_x?p.x += o: p.dock_x === b5.Actor.Dock_Left?p.x=-i+p.w*p.scale_x/2+p.margin[0]: p.dock_x === b5.Actor.Dock_Right && (p.x = i-p.w*p.scale_x/2+p.margin[1]),
      0 === p.dock_y?p.y += n: p.dock_y === b5.Actor.Dock_Top?p.y=-s+p.h*p.scale_y/2+p.margin[2]: p.dock_y === b5.Actor.Dock_Bottom && (p.y = s-p.h*p.scale_y/2+p.margin[3]),
      this.Virtual_clipLayout(p, i, s);
      else if (c === b5.Actor.Stack_H) {
        p = d[0];
        for (var _=-i+p.w*p.scale_x/2, l = 0;
          l < r;
          l++)p = d[l],
        p.x = _+p.margin[0],
        _ += p.w*p.scale_x+p.margin[1],
        this.Virtual_clipLayout(p, i, s)} else if (c === b5.Actor.Stack_V) {
        p = d[0];
        for (var u=-s+p.h*p.scale_y/2, l = 0;
          l < r;
          l++)p = d[l],
        p.y = u+p.margin[2],
        u += p.h*p.scale_y+p.margin[3],
        this.Virtual_clipLayout(p, i, s)}}if (e)for (var h = this.actors, l = 0;
      l < h.length;
      l++)h[l].Virtual_updateLayout(!0)}}, b5.Actor.prototype.Virtual_isClipped = function(e) {
  if (!this.clip_virtual)return!1;
  var t = this.w*this.scale_x/2,
  o = this.h*this.scale_y/2,
  a = e.w/2,
  n = e.h/2;
  return!!(e.y<-o-n || e.y > o+n || e.x<-t-a || e.x > t+a)}, b5.Actor.prototype.hitTest = function(e,f) {
  if (!this.touchable||!this.active)return null;
  var o = this.actors.length,
  a;
  if (0 < o)for (var n = this.actors, r = o-1;
    0 <= r;
    r--)if (a = n[r].hitTest(e), null !== a)return a;
  if (this.hit) {
    var i = this.scene,
    s = this.transform,
    c = s[4]+i.x,
    d = s[5]+i.y;
    this.ignore_camera || (c -= i.camera_x, d -= i.camera_y);
    var p = this.accum_scale_x,
    l = this.accum_scale_y,
    y = (e.x-c)/p,
    _ = (e.y-d)/l,
    u = y*s[0]+_*s[1],
    h = y*s[2]+_*s[3],
    g = this.w*p/2,
    m = this.h*l/2,
    q = this.touch_pos;
    this.touch_drag_x = e.x - q.x,
    this.touch_drag_y = e.y - q.y,
    q.x = e.x,
    q.y = e.y;
    if(this.scene.focus_actor !== this) {
    	this.touch_drag_x = 0,
    	this.touch_drag_y = 0;
    };
    var j = Math.abs(this.touch_drag_x)+1,
    k = Math.abs(this.touch_drag_y)+1;
    if (u>=-g && u <= g && h>=-m && h <= m)return this;
    if (u>=-g*j && u <= g*j && h>=-m*k && h <= m*k && j < Math.abs(g*2) && k < Math.abs(m*2)) { this.hovering && (this.hovering = !1, this.onHoverEnd &&this.onHoverEnd(e,f)), this.touching && (this.touching = !1, this.onEndTouch && this.onEndTouch(e,f))};
  }return null;
}, b5.Actor.prototype.transformPoint = function(e, t) {
  return b5.Maths.vecMulMatrix(e, t, this.transform)}, b5.Actor.prototype.setClipping = function(e, t) {
  var o = Math.PI,
  a = b5.app.display;
  a.saveContext();
  var n = this.clip_margin,
  r = this.clip_shape;
  if (null === r) {
    var i = this.type;
    i === b5.Actor.Type_Arc?a.clipArc(e+n[0], t+n[1], this.radius, 0, 2*o): i === b5.Actor.Type_Polygon?a.clipPolygon(this.points): a.clipRect(e+n[0], t+n[1], this.w-n[2]-n[0], this.h-n[3]-n[1])} else {
    var i = r.type;
    i === b5.Shape.TypeBox?a.clipRect(e+n[0], t+n[1], r.width-n[2]-n[0], r.height-n[3]-n[1]): i === b5.Shape.TypeCircle?a.clipArc(e+n[0], t+n[1], r.width, 0, 2*o): i === b5.Shape.TypePolygon && a.clipPolygon(r.vertices)}
  }, b5.Actor.prototype.findOverlaps = function(n) {
  	var e = this.parent || this.scene;
  	for(var t=0,o=e.actors,a=[];t<o.length;t++)o[t]!==this && (o[t].tag === n || !n) && this.overlaps(o[t]) && a.push(o[t]);
  	return a;
  }, b5.Actor.prototype.overlaps = function(e) {
  var t = this.type,
  o = e.type,
  n = t === b5.Actor.Type_Rect || t === b5.Actor.Type_Image,
  r = o === b5.Actor.Type_Rect || o === b5.Actor.Type_Image;
  //Rect and Rect
  if(n && r)return this.overlapsRect(e);
  //Rect and Circle or Circle and Rect
  else if(n && o === b5.Actor.Type_Arc)return e.circleOverlapsRect(this);
  else if(r && t === b5.Actor.Type_Arc)return this.circleOverlapsRect(e);
  //Circle and Circle
  else if(t === b5.Actor.Type_Arc && o === b5.Actor.Type_Arc)return this.circleOverlaps(e);
  else return !1
}, b5.Actor.prototype.overlapsRect = function(e) {
  var z = this.absolutePos(),
  l = e.absolutePos(),
  t = z.x,
  o = z.y,
  a = this.w>>1,
  n = this.h>>1,
  r = l.x,
  i = l.y,
  s = e.w>>1,
  c = e.h>>1;
  return t-a < r+s && t+a > r-s && o-n < i+c && o+n > i-c
}, b5.Actor.prototype.circleOverlapsRect = function(e) {
  var z = this.absolutePos(),
  l = e.absolutePos(),
  t = l.x-e.w/2,
  o = l.y-e.h/2,
  a = l.x+e.w/2,
  n = l.y+e.h/2,
  r = z.x,
  i = z.y,
  s = r < t?t: r > a?a: r,
  c = i < o?o: i > n?n: i,
  d = r-s,
  p = i-c;
  return d*d+p*p < this.radius/2*this.radius/2
}, b5.Actor.prototype.circleOverlaps = function(e) {
  var z = this.absolutePos(),
  l = e.absolutePos(),
  r = e.radius,
  p = this.radius,
  t = z.x - l.x,
  o = z.y - l.y,
  a = p*p/2+r*r/2;
  return (t*t+o*o)/a < Math.PI + Math.LN2
}, b5.Actor.prototype.distanceFrom = function(e) {
  var t = this.absolutePos(),
  o = e.absolutePos(),
  n = t.x-o.x,
  r = t.y-o.y;
  return Math.sqrt(n*n+r*r)
}, //Absolute position
b5.Actor.prototype.absolutePos = function(a) {
  if(a) for(var e = this, t = e.x+e.x2+e.ox, o = e.y+e.y2+e.oy;;) 
    if(e.parent) { t+=e.parent.x+e.parent.x2+e.parent.ox, o+=e.parent.y+e.parent.y2+e.parent.oy, e = e.parent}
    else return {x:t, y:o}
  else {
  	var e = this.parent;
  	return { x: this.x+this.x2+this.ox+(e?e.x+e.x2+e.ox:0),
  	  y: this.y+this.y2+this.oy+(e?e.y+e.y2+e.oy:0)
    }
  }
},
'use strict', b5.ArcActor = function() {
  this.fill_style = '#ffffff',
  this.stroke_style = '#ffffff',
  this.stroke_thickness = 1,
  this.radius = 1,
  this.start_angle = 0,
  this.end_angle = 2*Math.PI,
  this.filled=!0,
  this.stroke_filled=!1,
  b5.Actor.call(this),
  this.type = b5.Actor.Type_Arc
}, b5.ArcActor.prototype = new b5.Actor, b5.ArcActor.prototype.constructor = b5.ArcActor, b5.ArcActor.prototype.parent = b5.Actor.prototype, b5.ArcActor.prototype.update = function(e) {
  return this.baseUpdate(e)}, b5.ArcActor.prototype.draw = function() {
  if (this.visible && this.opacity) {
    if (this.cache && (this.drawToCache(), this.cache=!1), this.merge_cache)return this.drawChildren(!1),
    void this.drawChildren(!0);
    //New: Multiple draw per frame
    for(var v=0;v<this.redraw_count;v++){
    this.onRedraw && this.onRedraw(v+1);
    this.updateTransform();
    var e = this.drawChildren(!1),
    t = this.cache_canvas,
    o = this.scene,
    a = o.app,
    n = a.canvas_scale,
    r = a.display;
    // (FIXED, see Actor.prototype.preDraw for details) Fill style was broken when tyring to apply opacity
    null === t && (this.filled && '' !== this.fill_style && r.setFillStyle(this.fill_style), this.stroke_filled && '' !== this.stroke_style && r.setStrokeStyle(this.stroke_style), this.stroke_filled && r.setLineWidth(this.stroke_thickness));
    var i = a.canvas_cx+o.x*n,
    s = a.canvas_cy+o.y*n;
    this.ignore_camera || 0 !== this.depth && 1 !== this.depth || (i -= o.camera_x*n, s -= o.camera_y*n),
    this.preDraw();
    var c = this.self_clip,
    d = this.clip_children,
    p = this.transform,
    l = p[4]*n+i,
    y = p[5]*n+s;
    this.round_pixels && (l = 0|l+.5, y = 0|y+.5),
    r.setTransform(p[0]*n, p[1]*n, p[2]*n, p[3]*n, l, y),
    c && this.setClipping(0, 0),
    this.onDraw && this.onDraw(n),
    //Even with stroke_filled disabled, stroke still drawing, fixing it.
    null === t? r.drawArc(0, 0, this.radius, this.start_angle, this.end_angle, this.filled) : r.drawImage(t, -t.width>>1, -t.height>>1),
    this.postDraw(),
    d?!c && this.setClipping(0, 0): c && r.restoreContext(),
    e || this.drawChildren(!0),
    d && r.restoreContext()}
   }
  }, b5.ArcActor.prototype.drawToCache = function() {
  var e = b5.app.display,
  t = null,
  o = 2*this.padding,
  a = this.w+o,
  n = this.h+o,
  r = 0,
  i = 0;
  if (this.merge_cache) {
    var s = this.findFirstCachedParent();
    null !== s && (t = s.cache_canvas, r = this.x+t.width/2-a/2, i = this.y+t.height/2-n/2)}if (null === t) {
    var c = b5.app.pixel_ratio;
    t = e.createCache(),
    t.width = 0|a*c,
    t.height = 0|n*c
  }e.setCache(t),
  this.preDrawCached(),
  this.filled && '' !== this.fill_style && e.setFillStyle(this.fill_style),
  this.stroke_filled && '' !== this.stroke_style && e.setStrokeStyle(this.stroke_style),
  this.stroke_filled && e.setLineWidth(this.stroke_thickness),
  e.setTransform(1, 0, 0, 1, r+a/2, i+n/2),
  e.drawArc(0, 0, this.radius, this.start_angle, this.end_angle, this.filled),
  this.postDrawCached(),
  e.setCache(null),
  this.cache_canvas = t
}, b5.ArcActor.prototype.hitTest = function(e) {
  if (!this.touchable)return null;
  var o = this.actors.length,
  a;
  if (0 < o)for (var n = this.actors, i = 0;
    i < o;
    i++)if (a = n[i].hitTest(e), null !== a)return a;
  var s = this.scene,
  c = this.transform,
  d = c[4]+s.x,
  p = c[5]+s.y;
  this.ignore_camera || (d -= s.camera_x, p -= s.camera_y);
  var l = this.accum_scale_x,
  y = this.accum_scale_y,
  _ = (e.x-d)/l,
  u = (e.y-p)/y,
  h = _*c[0]+u*c[1],
  g = _*c[2]+u*c[3],
  m = this.radius*l;
  m *= m;
  return h*h+g*g <= m?this: null
}, 'use strict', b5.LabelActor = function() {
  this.text = '',
  this.font = {font:'16pt Calibri'},
  this.text_align = 'center',
  this.text_baseline = 'middle',
  this.fill_style = '#ffffff',
  this.stroke_style = '#ffffff',
  this.stroke_thickness = 1,
  this.line_height = 16,
  this.max_width = 0,
  this.filled=!0,
  this.stroke_filled=!1,
  b5.Actor.call(this),
  this.type = b5.Actor.Type_Label
}, b5.LabelActor.prototype = new b5.Actor, b5.LabelActor.prototype.constructor = b5.LabelActor, b5.LabelActor.prototype.parent = b5.Actor.prototype, Object.defineProperty(b5.LabelActor.prototype, '_text', {
    get: function() {
      return this.text
    }, set: function(e) {
      this.text !== e && (this.text = ''+e, null !== this.cache_canvas && (this.cache=!0))}}), b5.LabelActor.prototype.update = function(e) {
  return this.baseUpdate(e)}, b5.LabelActor.prototype.draw = function() {
  if (this.visible && '' !== this.text && this.opacity) {
    if (this.cache && (this.drawToCache(), this.cache=!1), this.merge_cache)return this.drawChildren(!1),
    void this.drawChildren(!0);
    //New: Multiple draw per frame
    for(var v=0;v<this.redraw_count;v++){
    this.onRedraw && this.onRedraw(v+1);
    this.updateTransform();
    var e = this.drawChildren(!1);
    this.preDraw();
    var t = this.cache_canvas,
    o = this.scene,
    a = o.app,
    n = a.canvas_scale,
    r = a.display;
    null === t && (null !== this.font && r.setFont(this.font.font), '' !== this.textAlign && r.setTextAlign(this.text_align), '' !== this.textBaseline && r.setTextBaseline(this.text_baseline), this.filled && '' !== this.fill_style && r.setFillStyle(this.fill_style), this.stroke_filled && '' !== this.stroke_style && r.setStrokeStyle(this.stroke_style), this.stroke_filled && r.setLineWidth(this.stroke_thickness));
    var i = b5.app.pixel_ratio;
    null === t && (i = 1);
    var s = a.canvas_cx+o.x*n/i,
    c = a.canvas_cy+o.y*n/i;
    this.ignore_camera || 0 !== this.depth && 1 !== this.depth || (s -= o.camera_x*n, c -= o.camera_y*n);
    var d = this.transform,
    p = d[4]*n+s,
    l = d[5]*n+c;
    if (this.round_pixels && (p = 0|p+.5, l = 0|l+.5), n /= i, r.setTransform(d[0]*n, d[1]*n, d[2]*n, d[3]*n, p, l), null === t)this.stroke_filled && (this.w = r.drawTextWrap(this.text, 0, 0, this.max_width, this.line_height, !1, this.text_baseline)),
    this.filled && (this.w = r.drawTextWrap(this.text, 0, 0, this.max_width, this.line_height, !0, this.text_baseline));
    else {
      var _=-t.width/2,
      u=-t.height/2;
      r.drawImage(t, _, u)}this.postDraw(),
    e || this.drawChildren(!0)}
   }
  }, b5.LabelActor.prototype.drawToCache = function() {
  var e = b5.app.display,
  t = null,
  o = 2*this.padding,
  a = this.w+o,
  n = this.h+o,
  i = 0,
  s = 0;
  if (this.merge_cache) {
    var c = this.findFirstCachedParent();
    null !== c && (t = c.cache_canvas, i = this.x+t.width/2-a/2, s = this.y+t.height/2-n/2)}if (null === t) {
    var d = b5.app.pixel_ratio;
    t = e.createCache(),
    t.width = 0|a*d,
    t.height = 0|n*d
  }if (e.setCache(t), this.preDrawCached(), '' !== this.font && e.setFont(this.font.font), '' !== this.textAlign && e.setTextAlign(this.text_align), '' !== this.textBaseline && e.setTextBaseline(this.text_baseline), this.filled && '' !== this.fill_style && e.setFillStyle(this.fill_style), this.stroke_filled && '' !== this.stroke_style && e.setStrokeStyle(this.stroke_style), this.stroke_filled && e.setLineWidth(this.stroke_thickness), e.setTransform(1, 0, 0, 1, 0, 0), 'center' === this.text_align?i += a/2: 'right' === this.text_align && (i += a), 'middle' === this.text_baseline?s += n/2: 'bottom' === this.text_baseline && (s += n), this.merge_cache) {
    var p = this.scene,
    l = [],
    y = this.rotation,
    r = Math.cos(y),
    _ = Math.sin(y),
    u = this.scale_x,
    h = this.scale_y;
    l[0] = r*u,
    l[1] = _*u,
    l[2]=-_*h,
    l[3] = r*h,
    l[4] = this.x+t.width/2-this.ox*this.ow,
    l[5] = this.y+t.height/2-this.oy*this.oh;
    var g = [1,
      0,
      0,
      1,
      this.ox*this.ow,
      this.oy*this.oh];
    b5.Maths.preMulMatrix(l, g),
    e.setTransform(1*l[0], 1*l[1], 1*l[2], 1*l[3], l[4], l[5]),
    this.stroke_filled && e.drawTextWrap(this.text, 0, 0, this.max_width, this.line_height, !1, this.text_baseline),
    this.filled && e.drawTextWrap(this.text, 0, 0, this.max_width, this.line_height, !0, this.text_baseline),
    e.setTransform(1, 0, 0, 1, 0, 0)} else e.setTransform(1, 0, 0, 1, 0, 0),
  this.stroke_filled && e.drawTextWrap(this.text, i, s, this.max_width, this.line_height, !1, this.text_baseline),
  this.filled && e.drawTextWrap(this.text, i, s, this.max_width, this.line_height, !0, this.text_baseline);
  this.postDrawCached(),
  e.setCache(null),
  this.cache_canvas = t
}, 'use strict', b5.ParticleActor = function() {
  b5.Actor.call(this),
  this.type = b5.Actor.Type_Particle,
  this.gravity = 0,
  this.added_callback = null,
  this.reset_callback = null
}, b5.ParticleActor.prototype = new b5.Actor, b5.ParticleActor.prototype.constructor = b5.ParticleActor, b5.ParticleActor.prototype.parent = b5.Actor.prototype, b5.ParticleActor.prototype.resetParticle = function(e) {
  if (e.life_time = 0, e.orphaned) {
    var t = this.transformPoint(e.org_x+this.x, e.org_y+this.y);
    e.x = t.x,
    e.y = t.y
  } else e.x = e.org_x,
  e.y = e.org_y;
  e.rotation = e.org_rotation,
  e.scale_x = e.org_scale_x,
  e.scale_y = e.org_scale_y,
  e.depth = e.org_depth,
  e.opacity = e.org_opacity,
  e.current_frame = e.org_current_frame,
  e.vr = e.org_vr,
  e.vx = e.org_vx,
  e.vy = e.org_vy,
  e.vd = e.org_vd,
  e.vo = e.org_vo,
  e.vsx = e.org_vsx,
  e.vsy = e.org_vsy,
  null !== this.reset_callback && this.reset_callback(e)}, b5.ParticleActor.prototype.addParticle = function(e, t, o, a) {
  if (this.addActor(e), void 0 === e.vo && (e.vo = 0), void 0 === e.vsx && (e.vsx = 0), void 0 === e.vsy && (e.vsy = 0), e.life_time=-a, e.life_span = t, e.num_lives = o, 0 > e.life_time && (e.active=!1, e.visible=!1), e.org_num_lives = e.num_lives, e.org_x = e.x, e.org_y = e.y, e.org_rotation = e.rotation, e.org_scale_x = e.scale_x, e.org_scale_y = e.scale_y, e.org_depth = e.depth, e.org_opacity = e.opacity, e.org_current_frame = e.current_frame, e.org_vr = e.vr, e.org_vx = e.vx, e.org_vy = e.vy, e.org_vd = e.vd, e.org_vo = e.vo, e.org_vsx = e.vsx, e.org_vsy = e.vsy, e.orphaned) {
    var n = this.transformPoint(e.org_x+this.x, e.org_y+this.y);
    e.x = n.x,
    e.y = n.y
  }return null !== this.added_callback && this.added_callback(e),
  e
}, b5.ParticleActor.prototype.update = function(e) {
  var o = this.actors,
  a = o.length;
  if (0 === a)void 0 !== this.onParticlesEnd && this.onParticlesEnd(),
  this.destroy();
  else for (var n = a-1, r;
    0 <= n;
    n--) {
    r = o[n],
    r.life_time += e;
    var i = r.life_time;
    0 <= i && (0 > i-e && 0 <= i && (r.active=!0, r.visible=!0), r.active && (r.scale_x += r.vsx*e, r.scale_y += r.vsy*e, r.opacity += r.vo*e, 0 > r.opacity && (r.opacity = 0), r.vy += this.gravity*e, r.update(e), i >= r.life_span && (0 < r.num_lives && r.num_lives--, 0 < r.num_lives || 0 === r.org_num_lives?this.resetParticle(r): void 0 === this.onParticleLost?r.destroy(): this.onParticleLost(r) && r.destroy())))}return this.baseUpdate(e)}, b5.ParticleActor.prototype.generateExplosion = function(e, o, a, n, r, i, s, c) {
  this.updateParentTransforms();
  for (var d = 0;
    d < e;
    d++) {
    var l;
    for (var y in l = 'string' == typeof o?new b5[o]: new o, c)l[y] = c[y];
    l.vr += Math.random()*r,
    l.vx += Math.random()*n-n/2,
    l.vy += Math.random()*n-n/2,
    l.vx_damping = s,
    l.vy_damping = s,
    l.vo=-1/a,
    this.addParticle(l, a, 1, d/(e*i))}}, b5.ParticleActor.prototype.generatePlume = function(e, o, a, n, r, i, s, c) {
  this.updateParentTransforms();
  for (var d = 0;
    d < e;
    d++) {
    var l;
    for (var y in l = 'string' == typeof o?new b5[o]: new o, c)l[y] = c[y];
    l.vr += Math.random()*r,
    l.vx += Math.random()*n-n/2,
    l.vy += Math.random()*-n-n/2,
    l.vx_damping = s,
    l.vy_damping = s,
    l.vo=-1/a,
    this.addParticle(l, a, 0, d/(e*i))}}, b5.ParticleActor.prototype.generateRain = function(e, o, a, n, r, i, s, c, d) {
  this.updateParentTransforms();
  for (var l = 0;
    l < e;
    l++) {
    var y;
    for (var _ in y = 'string' == typeof o?new b5[o]: new o, d)y[_] = d[_];
    y.x = Math.random()*c-c/2,
    y.vr += Math.random()*r,
    y.vy += Math.random()*n+n/2,
    y.vx_damping = s,
    y.vy_damping = s,
    y.vo=-1/a,
    this.addParticle(y, a, 0, l/(e*i))}}, 'use strict', b5.PolygonActor = function() {
  this.fill_style = '#ffffff',
  this.stroke_style = '',
  this.stroke_thickness = 1,
  this.filled=!0,
  this.stroke_filled=!1,
  this.points = null,
  b5.Actor.call(this),
  this.type = b5.Actor.Type_Polygon
}, b5.PolygonActor.prototype = new b5.Actor, b5.PolygonActor.prototype.constructor = b5.PolygonActor, b5.PolygonActor.prototype.parent = b5.Actor.prototype, b5.PolygonActor.prototype.update = function(e) {
  return this.baseUpdate(e)}, b5.PolygonActor.prototype.draw = function() {
  if (this.visible && null !== this.points && this.opacity) {
    if (this.cache && (this.drawToCache(), this.cache=!1), this.merge_cache)return this.drawChildren(!1),
    void this.drawChildren(!0);
    this.updateTransform();
    //New: Multiple draw per frame
    for(var v=0;v<this.redraw_count;v++){
    this.onRedraw && this.onRedraw(v+1);
    var e = this.drawChildren(!1),
    t = this.cache_canvas,
    o = this.scene,
    a = o.app,
    n = a.display;
    null === t && (this.filled && '' !== this.fill_style && n.setFillStyle(this.fill_style), this.stroke_filled && '' !== this.stroke_style && n.setStrokeStyle(this.stroke_style), this.stroke_filled && n.setLineWidth(this.stroke_thickness));
    var r = a.canvas_scale,
    i = a.canvas_cx+this.scene.x*r,
    s = a.canvas_cy+this.scene.y*r;
    this.ignore_camera || 0 !== this.depth && 1 !== this.depth || (i -= o.camera_x*r, s -= o.camera_y*r),
    this.preDraw();
    var c = this.self_clip,
    d = this.clip_children,
    p = this.transform,
    l = p[4]*r+i,
    y = p[5]*r+s;
    this.round_pixels && (l = 0|l+.5, y = 0|y+.5),
    n.setTransform(p[0]*r, p[1]*r, p[2]*r, p[3]*r, l, y),
    c && this.setClipping(0, 0),
    this.onDraw && this.onDraw(n),
    null === t?n.drawPolygon(0, 0, this.points, this.filled): n.drawImage(t, -t.width>>1, -t.height>>1),
    this.postDraw(),
    d?!c && this.setClipping(0, 0): c && n.restoreContext(),
    e || this.drawChildren(!0),
    d && n.restoreContext()}
   }
  }, b5.PolygonActor.prototype.drawToCache = function() {
  var e = b5.app.display,
  t = null,
  o = 2*this.padding,
  a = this.w+o,
  n = this.h+o,
  r = 0,
  i = 0;
  if (this.merge_cache) {
    var s = this.findFirstCachedParent();
    null !== s && (t = s.cache_canvas, r = this.x+t.width/2-a/2, i = this.y+t.height/2-n/2)}if (null === t) {
    var c = b5.app.pixel_ratio;
    t = e.createCache(),
    t.width = 0|a*c,
    t.height = 0|n*c
  }e.setCache(t),
  this.preDrawCached(),
  this.filled && '' !== this.fill_style && e.setFillStyle(this.fill_style),
  this.stroke_filled && '' !== this.stroke_style && e.setStrokeStyle(this.stroke_style),
  this.stroke_filled && e.setLineWidth(this.stroke_thickness),
  e.setTransform(1, 0, 0, 1, r+a/2, i+n/2),
  e.drawPolygon(0, 0, this.points, this.filled),
  this.postDrawCached(),
  e.setCache(null),
  this.cache_canvas = t
}, 'use strict', b5.RectActor = function() {
  this.fill_style = '#ffffff',
  this.stroke_style = '#ffffff',
  this.stroke_thickness = 1,
  this.corner_radius = 0,
  this.filled=!0,
  this.stroke_filled=!1,
  b5.Actor.call(this),
  this.type = b5.Actor.Type_Rect
}, b5.RectActor.prototype = new b5.Actor, b5.RectActor.prototype.constructor = b5.RectActor, b5.RectActor.prototype.parent = b5.Actor.prototype, b5.RectActor.prototype.update = function(e) {
  return this.baseUpdate(e)}, b5.RectActor.prototype.draw = function() {
  if (this.visible && this.opacity) {
    if (this.cache && (this.drawToCache(), this.cache=!1), this.merge_cache)return this.drawChildren(!1),
    void this.drawChildren(!0);
    //New: Multiple draw per frame
    for(var v=0;v<this.redraw_count;v++){
    this.onRedraw && this.onRedraw(v+1);
    this.updateTransform();
    var e = this.drawChildren(!1),
    t = this.cache_canvas,
    o = this.scene,
    a = o.app,
    n = a.canvas_scale,
    r = a.display;
    null === t && (this.filled && '' !== this.fill_style && r.setFillStyle(this.fill_style), this.stroke_filled && '' !== this.stroke_style && r.setStrokeStyle(this.stroke_style), this.stroke_filled && r.setLineWidth(this.stroke_thickness));
    var i = a.canvas_cx+o.x*n,
    s = a.canvas_cy+o.y*n,
    c = this.w/2,
    d = this.h/2;
    this.ignore_camera || 0 !== this.depth && 1 !== this.depth || (i -= o.camera_x*n, s -= o.camera_y*n),
    this.preDraw();
    var p = this.self_clip,
    l = this.clip_children,
    y = this.transform,
    _ = y[4]*n+i,
    u = y[5]*n+s;
    this.round_pixels && (c = 0|c+.5, d = 0|d+.5, _ = 0|_+.5, u = 0|u+.5),
    r.setTransform(y[0]*n, y[1]*n, y[2]*n, y[3]*n, _, u),
    p && this.setClipping(-c, -d),
    this.onDraw && this.onDraw(n),
    null === t?0 === this.corner_radius?r.drawRect(-c, -d, this.w, this.h, this.filled): r.drawRoundRect(-c, -d, this.w, this.h, this.corner_radius, this.filled): r.drawImage(t, -t.width>>1, -t.height>>1),
    this.postDraw(),
    l?!p && this.setClipping(-c, -d): p && r.restoreContext(),
    e || this.drawChildren(!0),
    l && r.restoreContext()}
   }
  }, b5.RectActor.prototype.drawToCache = function() {
  var e = b5.app.display,
  t = null,
  o = 2*this.padding,
  a = this.w+o,
  n = this.h+o,
  r = 0,
  i = 0;
  if (this.merge_cache) {
    var s = this.findFirstCachedParent();
    null !== s && (t = s.cache_canvas, r = this.x+t.width/2-a/2, i = this.y+t.height/2-n/2)}if (null === t) {
    var c = b5.app.pixel_ratio;
    t = e.createCache(),
    t.width = 0|a*c,
    t.height = 0|n*c
  }e.setCache(t),
  this.preDrawCached(),
  this.filled && '' !== this.fill_style && e.setFillStyle(this.fill_style),
  this.stroke_filled && '' !== this.stroke_style && e.setStrokeStyle(this.stroke_style),
  this.stroke_filled && e.setLineWidth(this.stroke_thickness),
  e.setTransform(1, 0, 0, 1, r+a/2, i+n/2),
  0 === this.corner_radius?e.drawRect(-a/2, -n/2, this.w, this.h, this.filled): e.drawRoundRect(-a/2, -n/2, this.w, this.h, this.corner_radius, this.filled),
  this.postDrawCached(),
  e.setCache(null),
  this.cache_canvas = t
}, 'use strict', b5.MapActor = function() {
  this.tiles = [],
  this.map = [],
  this.collision_map = [],
  this.tile_width = 32,
  this.tile_height = 32,
  this.map_width = 0,
  this.map_height = 0,
  this.display_width = 8,
  this.display_height = 8,
  b5.Actor.call(this),
  this.type = b5.Actor.Type_Map
}, b5.MapActor.prototype = new b5.Actor, b5.MapActor.prototype.constructor = b5.MapActor, b5.MapActor.prototype.parent = b5.Actor.prototype, b5.MapActor.prototype.update = function(e) {
  return this.baseUpdate(e)}, b5.MapActor.prototype.generateTiles = function(e, o, a, n) {
  for (var r = .5, i = .5, s = 0;
    s < e;
    s++)this.tiles[s] = {
    x: r,
    y: i
  },
  r += o,
  r >= n && (r = .5, i += a);
  this.tile_width = o,
  this.tile_height = a
}, b5.MapActor.prototype.setTile = function(e, t, o, a) {
  var n = this.map_width,
  r = this.map_height;
  0 > e || e >= n || 0 > t || t >= r || (a !== void 0 && a?this.collision_map[t*n+e] = o: this.map[t*n+e] = o)}, b5.MapActor.prototype.getTile = function(e, t, o) {
  var a = this.map_width,
  n = this.map_height;
  return 0 > e || e >= a?-1: 0 > t || t >= n?-1: void 0 !== o && o?this.collision_map[t*a+e]: this.map[t*a+e]}, b5.MapActor.prototype.getTileXY = function(e, t) {
  var o = Math.round,
  a = this.map_width,
  n = this.map_height,
  r = this.tile_width,
  i = this.tile_height;
  return {
    x: o((e-r/2)/r)+(a>>1),
    y: o((t-i/2)/i)+(n>>1)}}, b5.MapActor.prototype.getTilePosition = function(e, t, o) {
  var a = this.tile_width,
  n = this.tile_height,
  r = this.getTileXY(e, t);
  return r.x -= this.map_width>>1,
  r.y -= this.map_height>>1,
  r.x *= a,
  r.y *= n,
  'm' === o?r.y += n/2: 'b' === o?r.y += n: 'c' === o?r.x += a/2: 'r' == o && (r.x += a),
  r
}, b5.MapActor.prototype.getTileFromPosition = function(e, t, o) {
  var a = this.getTileXY(e, t);
  return this.getTile(a.x, a.y, o)}, b5.MapActor.prototype.draw = function() {
  if (this.visible && this.opacity) {
    var e = this.scene,
    t = e.app,
    o = t.canvas_scale,
    a = t.display,
    n = t.canvas_cx+e.x*o,
    r = t.canvas_cy+e.y*o;
    this.ignore_camera || 0 !== this.depth && 1 !== this.depth || (n -= e.camera_x*o, r -= e.camera_y*o),
    this.updateTransform();
    var i = this.drawChildren(!1);
    this.preDraw();
    var s = this.transform,
    c = s[4]*o+n,
    d = s[5]*o+r;
    this.round_pixels && (c = 0|c+.5, d = 0|d+.5),
    a.setTransform(s[0]*o, s[1]*o, s[2]*o, s[3]*o, c, d);
    var p = this.map_width,
    l = this.map_height,
    _ = this.tile_width,
    u = this.tile_height,
    h = this.map,
    g = this.tiles,
    m,
    f,
    A,
    v,
    w;
    null === this.bitmap?null !== this.atlas && (w = this.atlas.bitmaps[this.current_bitmap]): w = this.bitmap;
    var b = w.image,
    T = this.display_width,
    S = this.display_height;
    n = T === p?-T>>1: 0|(e.camera_x-this.x)/_-(T>>1)+.5;
    var C = n;
    r = S === l?-S>>1: 0|(e.camera_y-this.y)/u-(S>>1)+.5;
    var k = n*_,
    P = k,
    R = r*u;
    for (n += p>>1, C = n, r += l>>1, f = 0;
      f < S;
      f++) {
      if (0 <= r && r < l)for (n = C, k = P, m = 0;
        m < T && (0 <= n && (A = h[r*p+n], v = g[A], a.drawAtlasImage(b, v.x, v.y, _-1, u-1, k, R, _+1, u+1)), k += _, n++, !(n >= p));
        m++);
      if (R += u, r++, r >= l)break
    }this.postDraw(),
    i || this.drawChildren(!0)}},
 !b5.Sound && (b5.Sound = {}),
 'use strict', 
 b5.App = function(e, t, o) {
  typeof o != 'object' && (o = {}),
  b5.app = this,
  this.removals = [],
  this.touched=!1,
  this.touch_pos = {
    x: 0,
    y: 0
  },
  this.touch_drag_x = 0,
  this.touch_drag_y = 0,
  this.last_time = performance.now(),
  this.dt = 0,
  this.avg_time = this.last_time,
  this.avg_fps = 60,
  this.a_avg_fps = 60,
  this.avg_frame = 0,
  this.canvas_scale = 1,
  this.pixel_ratio = 1,
  this.canvas_pixel_ratio = 1,
  this.design_width = e.width,
  this.design_height = e.height,
  this.display_width = e.width,
  this.display_height = e.height,
  this.adapt_resolution = true,
  this.canvas_cx = this.design_width>>1,
  this.canvas_cy = this.design_height>>1,
  this.order_changed=!0,
  this.total_loaded = 0,
  this.total_load_errors = 0,
  this.inner_width = b5.Display.getWidth(),
  this.inner_height = b5.Display.getHeight(),
  this.fill_screen=!1,
  this.center_canvas = !0,
  this.disable_dock_screen=!1,
  this.started = null,
  this.num_logic = 0,
  this.num_draw = 0,
  this.world = null,
  this.scenes = [],
  this.canvas = e,
  this.force_rescaling = !1,
  this.canvas_scale_method = b5.App.FitNone,
  this.touch_supported = this.isTouchSupported(),
  this.allow_touchables=!0,
  this.target_frame_rate = 60,
  this.adaptive_physics=!1,
  this.focus_scene = null,
  this.focus_scene2 = null,
  this.hover_focus = null,
  this.clear_canvas=!1,
  this.touch_focus = null,
  this.global_scale = 1,
  this.prevent_default=!1,
  //New: global smoothing filter
  this.canvas_smoothing = !0,
  //framerate limiter
  this.fps_limit = 60,
  //vsync
  this.vsync = true,
  //New: pause app
  this.active = !0,
  //New: cursor hide/show after time
  this.cursor = 'default',
  this.hide_cursor = !1,
  this.cursor_hide_time = 2000,
  this._cursor_hide_time_counter = 0,
  //Utilities when pausing/resuming app
  this.mute_on_pause = !0,
  this.freeze_on_pause = !0,
  this.visible = !0,
  //Offscreen canvas feature
  this.offscreen_rendering = !1,
  this.context_options = o,
  //Splash screen (wait for sound engine / startup files to load)
  this.show_splash = !0,
  this.debug=!1,
  this.timelines = new b5.TimelineManager,
  b5.ActionsListManager !== void 0 && (this.actions = new b5.ActionsListManager),
  this.events = new b5.EventsManager,
  this.tasks = new b5.TasksManager,
  this.box2d = 'undefined' != typeof Box2D,
  this.instants = 'undefined' != typeof FBInstant,
  this.use_web_audio = t?!0:!1,
  this.audio_config = { sampleRate: 44100 },
  this.shared_world=!1,
  this.time_step = .03333,
  this.mobile = b5.Utils.IsMobile(),
  this.platform = b5.Utils.GetPlatform(),
  this.bitmaps = {},
  this.brushes = {},
  this.shapes = {},
  this.materials = {},
  this.sounds = {},
  this.fonts = {},
  this.raw = {},
  //Placeholder for event listeners
  this.onPause = null,
  this.onResume = null,
  this.onBack = null,
  this.onResize = null,
  this.onBatteryLevel = null,
  this.onBatteryCharging = null,
  this.onTick = null,
  this.onResourceLoaded = function(e, t) {
    this.onResourceLoadedBase(e, t)
  },
  this.display = new b5.Display(this.canvas, this.context_options, true);
  this.display.offscreen_canvas = new OffscreenCanvas(e.width,e.height),
  this.display.context_primary = this.display.context;
  this.display.context_offscreen = this.display.offscreen_canvas.getContext("2d", o.context_options),

  b5.Display.setBackgroundColor("black");
  this.setBackgroundColor('black');
  //Event listeners
  window.navigator.msPointerEnabled?(
    e.addEventListener('MSPointerDown', this.onTouchStart, !1), 
    e.addEventListener('MSPointerMove', this.onTouchMove, !1), 
    e.addEventListener('MSPointerUp', this.onTouchEnd, !1)
    ):(
    e.addEventListener('touchstart', this.onTouchStart, !1), 
    e.addEventListener('touchmove', this.onTouchMove, !1), 
    e.addEventListener('touchend', this.onTouchEnd, !1),
    
    e.addEventListener('mousedown', this.onTouchStart, !1), 
    e.addEventListener('mousemove', this.onTouchMove, !1), 
    e.addEventListener('mouseup', this.onTouchEnd, !1), 
    e.addEventListener('mouseout', this.onTouchEnd, !1)
  );
  var s = 'onwheel' in this.canvas ?'wheel': document.onmousewheel === void 0?'DOMMouseScroll': 'mousewheel';
  addEventListener(s, this.onWheel, !1);
  addEventListener('keypress', this.onKeyPress, !1),
  addEventListener('keydown', this.onKeyDown, !1),
  addEventListener('keyup', this.onKeyUp, !1),
  //Display events
  window.addEventListener('resize',this.onResizeBase,!1),
  this.canvas.addEventListener('contextmenu',function(t){
    b5.app.prevent_default && t.preventDefault();
  },!1),
  //Visibility events
  document.addEventListener('visibilitychange',this.onVisibilityChangeBase,!1),
  //New: onBack (back button in mobile devices, disabled in browsers)
  window.addEventListener('popstate', this.onBackBase, !1),
  //Extra: Battery events
  navigator.getBattery && navigator.getBattery().then(batt=>{
    var e = b5.app;
    e.battery_info = {
      charging: batt.charging,
      level: batt.level
    },
    batt.onlevelchange = e.onBatteryStateChangeBase,
    batt.onchargingchange = e.onBatteryStateChangeBase;
  });
 },
 
  Object.defineProperty(b5.App.prototype, '_focus_scene', {
    get: function() {
      return this.focus_scene
    }, set: function(e) {
      this.focus_scene !== e && (this.focus_scene = b5.Utils.resolveObject(e))}}), Object.defineProperty(b5.App.prototype, '_focus_scene2', {
    get: function() {
      return this.focus_scene2
    }, set: function(e) {
      this.focus_scene2 !== e && (this.focus_scene2 = b5.Utils.resolveObject(e))}}), b5.App.FitNone = 0, b5.App.FitX = 1, b5.App.FitY = 2, b5.App.FitBest = 3, b5.App.FitSize = 4, b5.App.FitGreatest = 5, b5.App.FitSmallest = 6, b5.App.FitBest2 = 7, 
  b5.App.prototype.onKeyPress = function(e) {
    var t = b5.app;
    null != t.focus_scene && t.focus_scene.onKeyPressBase(e)
  }, 
  b5.App.prototype.onKeyDown = function(e) {
    var t = b5.app;
    null != t.focus_scene && t.focus_scene.onKeyDownBase(e),
    b5.Keyboard.e(e);
  }, 
  b5.App.prototype.onKeyUp = function(e) {
    var t = b5.app;
    null != t.focus_scene && t.focus_scene.onKeyUpBase(e),
    b5.Keyboard.e(e);
  }, 
  b5.App.prototype.isTouchSupported = function() {
  var e = window.navigator.msMaxTouchPoints,
  t = b5.Utils.HasTouchscreen() || 'onmousedown' in this.canvas;
  return!!(e || t )}, 
  /* NEW! */
  b5.Keyboard = function() {
    var e = b5.Keyboard.listeners;
    this.index = e.length,
    this.raw = {},
    this.key = {},
    this.lowercase_raw = !1,
    e.push(this);
  },
  b5.Keyboard.e = function(k) {
    for(var i=0, e=b5.Keyboard.listeners; i< e.length;i++) e[i].update(k);
   
  },
  b5.Keyboard.listeners = [],
  b5.Keyboard.prototype.update = function(e) {
  	var t = this.lowercase_raw,
  	o = t ? e.key.toLowerCase() : e.key,
  	a = t ? e.code.toLowerCase() : e.code;
    e.type == "keydown" && !e.repeat && (this.raw[o] = !0, this.key[a] = !0);
    e.type == "keyup" && (this.raw[o] = !1, this.key[a] = !1);
  },
  b5.Keyboard.prototype.destroy = function() {
    b5.Keyboard.listeners.splice(this.index,1);
  },
  /* NEW! */
  b5.Gamepad = function(e) {
    this.index = b5.Gamepad.listeners.length,
    this.gamepad_index = e,
    this.button = {},
    this.axis = {
      HAT: {x: 0, y: 0},
      LSTICK: {x: 0, y: 0},
      RSTICK: {x: 0, y: 0},
      LTRIGGER: {x: 0},
      RTRIGGER: {x: 0}
    },
    this.connected = !1,
    this.name = "",
    this.vendor_code = "0000",
    this.product_code = "0000",
    this.mapping = {
    	//Standard Gamepad
      buttons: ["A","B","X","Y","LB","RB","LT","RT","SELECT","START","THUMBL","THUMBR","UP","DOWN","LEFT","RIGHT","HOME"],
      axes: ["LSTICK.x","LSTICK.y","RSTICK.x","RSTICK.y"]
    };
    //Setup buttons
    for(var i=0, t = this.mapping.buttons;i < t.length;i++) this.button[ t[i] ] = 0;
    b5.Gamepad.listeners.push(this);
  },
  b5.Gamepad.listeners = [],
  b5.Gamepad.prototype.update = function(e) {
    var t = this.mapping.buttons,
    a = this.mapping.axes;
    if(e) {
    //Update data
      if(!this.connected) {
        this.connected = !0;
        this.name = e.id.substr(0,e.id.lastIndexOf("(Vendor")).trim(),
        this.vendor_code = e.id.substr(e.id.lastIndexOf("Vendor: ")+8,4),
        this.product_code = e.id.substr(e.id.lastIndexOf("Product: ")+9,4);      
      }
      //Buttons
      for(var i=0, o=e.buttons;i < o.length;i++)
        this.button[ t[i] || ("BUTTON"+i) ] = o[i].value;
      
      //HAT as Axis
      var n = 0, r = 0, i = t.indexOf("UP"), s =	t.indexOf("DOWN"), u = t.indexOf("LEFT"), d = t.indexOf("RIGHT");
      //UP (y-)
      o[i].pressed && ( r = o[s].pressed ? 0 : -1),
      //DOWN (y+)
      o[s].pressed && ( r = o[i].pressed ? 0 : 1),
      //LEFT (x-)
      o[u].pressed && ( n = o[d].pressed ? 0 : -1),
      //RIGHT (x+)
      o[d].pressed && ( n = o[u].pressed ? 0 : 1),
        
      this.axis["HAT"] = { x: n, y: r};
      //Axes
      s = null;
      for(var i=0, o=e.axes;i < o.length;i++) {
        s = a[i].split(".");
        this.axis[ s[0] ][ s[1] ]= Math.round(o[i]*100)*0.01;
      }
   }
   else this.connected = !1;
  },
  b5.Gamepad.prototype.map = function(e,t,o) {
    var a = this.mapping[e];
    a[t] = o.toUpperCase();
  },
  b5.Gamepad.prototype.destroy = function() {
    b5.Gamepad.listeners.splice(this.index,1);
  },
  /* Queue system */
  b5.ResourceQueue = function() {},
  b5.ResourceQueue.in_queue = [],
  b5.ResourceQueue.results = [],
  b5.ResourceQueue._processing = !1,
  b5.ResourceQueue.ended = !0,
  b5.ResourceQueue.add = function(e) {
  	b5.ResourceQueue.in_queue.push(e);
  },
  b5.ResourceQueue.load = function() {
  	b5.ResourceQueue.ended && (b5.ResourceQueue.results = []);
  	if(!b5.ResourceQueue._processing) {
  	  var e = b5.ResourceQueue.in_queue,
  	  t = e[0];
  	  b5.ResourceQueue._processing = !0;
  	  b5.ResourceQueue.ended = !1;
  	  t.onload = function(o,a) {
  		  var n = b5.ResourceQueue;
  		  n._processing = !1;
  		  n.in_queue.shift();
  		  n.results.push(a != undefined ? a : true);
  		  this.onerror && (this.onerror =	null),
  		  n.in_queue.length > 0 ? (n._processing = !1, n.load(), n.onupdate && n.onupdate(o,a)) : (n.onload && n.onload(n.results), n.ended = !0);
  	  },
  	  t.onerror = function() { this.onload(this,!1) };
  	  t.load ? t.load() : t.onerror();
  	}
  },
  b5.ResourceQueue.onload = null,
  b5.ResourceQueue.onupdate = null,
  
  b5.App.prototype.setRenderingToOffscreen = function(e){
    this.offscreen_rendering = e,
    
    //Switch contexts
    this.display.context = e ? this.display.context_offscreen : this.display.context_primary,
    this.debug && console.log('Rendering from '+this.display.context.toString().replace(/\[object |RenderingContext2D]/gi,"")),

    this.onResizeBase();
  },
  b5.App.prototype.screenshot = function() {
   return this.canvas.toDataURL();
  },
  b5.App.prototype.exit = function() {
  	window.close();
  	navigator.app && navigator.app.exitApp();
  }
  //For computers or if you have a mouse connected
  b5.App.prototype.setCursor = function(e) {
    var t = e.indexOf(".")>-1?'url('+e+'),auto':e;
    e != 'none' && (this.cursor = t);
    return this.canvas.style.cursor = t;
  },
  b5.App.prototype.onResizeBase = function(i) {
    var e = b5.app,
    t = b5.Display.getWidth(),
    o = b5.Display.getHeight(),
    a = {},
    n,r;
    //For some reason, if fast resizing occurs, scaling method returns to none, so it needs to do it twice
    for(var s=0;s<2;s++) {
      e.setCanvasScalingMethod(),
      e.offscreen_rendering && e.setOffscreenCanvasScalingMethod();
    }
    n = e.inner_width,
    r = e.inner_height,
    e.center_canvas && ( a = b5.Utils.GetCenterPos(t,o,n,r), e.setCanvasPosition(a.left,a.top) ), 
    e.onResize && e.onResize(t,o,n,r,a.left,a.top);
    e.resizeCover && e.resizeCover(t,o,n,r,a.left,a.top);
  },
  
  //Added important missing feature:
  b5.App.prototype.onVisibilityChangeBase = function() {
    var e = b5.app, t = document.visibilityState == "visible";
    e.visible = t;
    e.adt && ( t ? (
       //Resume audio playback if setted
       e.mute_on_pause && b5.Sound.context && b5.Sound.context.resume(),
       //Resume app
       !e.paused && (
         e.freeze_on_pause && e.resume(),
         e.onResume && e.onResume()
        )
    ):(
       //Pause audio playback if setted
       e.mute_on_pause && b5.Sound.context && b5.Sound.context.suspend(),
       //Pause App
       e.freeze_on_pause && e.pause(true),
       e.onPause && e.onPause()
    ));
  },
  //Battery event handler
  b5.App.prototype.onBatteryStateChangeBase = function(e) {
    var t = b5.app, o = e.currentTarget;
    t.battery_info.charging = o.charging,
    t.battery_info.level = o.level,
    e.type == "levelchange" && t.onBatteryLevel && t.onBatteryLevel(o.level),
    e.type == "chargingchange" && t.onBatteryCharging && t.onBatteryCharging(o.charging);
  },
  b5.App.prototype.onBackBase = function(e) {
  	b5.app.onBack && b5.app.onBack();
  },

  b5.App.prototype.onTouchStart = function(t) {
  var e = b5.app,
  //New: Identify device type (touchscreen, mouse)
  i = {type: t.type, button: t.button};
   //t.touches is undefined, redundant code, optimizing it
//  if (!(e.touch_supported && (t.stopPropagation(), !e.prevent_default && t.preventDefault()/*FAULTY[NOT MORE]*/, 1 > 2/*t.touches.length/**/))) {

  if(e.touch_supported) {
    t.stopPropagation();
    e.prevent_default && t.preventDefault();
    var o = e.focus_scene,
    a = e.focus_scene2;
    if (e.touched=!0, e.touch_pos = e.touch_supported && void 0 !== t.changedTouches?e.getCanvasPoint(t.changedTouches[0].pageX, t.changedTouches[0].pageY): e.getCanvasPoint(t.pageX, t.pageY), null != o && o.onBeginTouchBase(e.touch_pos,i), null != a && a.onBeginTouchBase(e.touch_pos,i), e.allow_touchables) {
      var r = e.findHitActor(e.touch_pos);
      r && (r.scene.focus_actor = r);
      null != r && (e.touch_focus = r, r.onBeginTouchBase(e.touch_pos,i), r.touchmove=false)}}}, 
  b5.App.prototype.onTouchEnd = function(t) {
  var e = b5.app,
  i = t.type;
   //t.touches is undefined, redundant code, fixing it
  // !(e.touch_supported && (t.stopPropagation(), e.prevent_default && t.preventDefault() /*FAULTY[NOT MORE]*/, 1 > 2/*t.touches.length/**/))) {
  
   if(e.touch_supported) {
    t.stopPropagation();
    e.prevent_default && t.preventDefault();
    var o = e.focus_scene,
    a = e.focus_scene2;
    if (e.touched=!1, e.touch_pos = e.touch_supported && void 0 !== t.changedTouches?e.getCanvasPoint(t.changedTouches[0].pageX, t.changedTouches[0].pageY): e.getCanvasPoint(t.pageX, t.pageY), null != o && o.onEndTouchBase(e.touch_pos,i), null != a && a.onEndTouchBase(e.touch_pos,i), e.allow_touchables) {
      var r = e.findHitActor(e.touch_pos,i);
      r && (r.scene.focus_actor = null);
      null != r && r.onEndTouchBase(e.touch_pos,i),
      null != e.touch_focus && (void 0 !== e.touch_focus.onLostTouchFocus && e.touch_focus.onLostTouchFocus(e.touch_pos), e.touch_focus = null) }} 
}, b5.App.prototype.onTouchMove = function(t) {
  var e = b5.app,
  p = t.type;
  
  //Reset cursor hiding counter
  e.hide_cursor && (
  e._cursor_hide_time_counter = 0,
  e.canvas.style.cursor != e.cursor && e.setCursor(e.cursor)
  );
   //t.touches is undefined, redundant code, fixing it
 // if (!(e.touch_supported && (t.stopPropagation(), e.prevent_default && t.preventDefault()/*FAULTY[NOT MORE]*/, 1 > 2/*t.touches.length/**/))) {
 if(e.touch_supported) {
    t.stopPropagation();
    e.prevent_default && t.preventDefault();
    var o = e.focus_scene,
    a = e.focus_scene2,
    n = e.touch_pos.x,
    r = e.touch_pos.y;
    if (e.touch_pos = e.touch_supported && void 0 !== t.changedTouches?e.getCanvasPoint(t.changedTouches[0].pageX, t.changedTouches[0].pageY): e.getCanvasPoint(t.pageX, t.pageY), e.raw_touch_x = t.pageX, e.raw_touch_y = t.pageY, e.touch_drag_x = n-e.touch_pos.x, e.touch_drag_y = r-e.touch_pos.y, null != o && o.onMoveTouchBase(e.touch_pos,p,t.touches), null != a && a.onMoveTouchBase(e.touch_pos,p,t.touches), e.allow_touchables) {
      var s = e.findHitActor(e.touch_pos);
      s && (s.scene.focus_actor = s);
      null != s && (s.hovering = !0, s.onMoveTouchBase(e.touch_pos,p,e.touches)),
      /*null !== e.hover_focus && void 0 !== e.hover_focus.onHover && e.hover_focus.onHoverEnd(e.touch_pos,p),*/
      e.hover_focus = s,
      null !== s && void 0 !== s.onHover && s.onHover(e.touch_pos,p)}}}, b5.App.prototype.onWheel = function(t) {
  var e = b5.app;
  e.touch_supported && (t.stopPropagation(), e.prevent_default && t.preventDefault());
  var o = e.focus_scene,
  a = e.focus_scene2;
  null != o && o.onWheelBase(t),
  null != a && a.onWheelBase(t)}, b5.App.prototype.addScene = function(e) {
  return this.scenes.push(e),
  e.app = this,
  e
}, b5.App.prototype.removeScene = function(e) {
  this.focus_scene == e && (this.focus_scene = null),
  this.removals.push(e)}, b5.App.prototype.cleanupDestroyedScenes = function() {
  var e = this.removals.length;
  if (0 < e)for (var o = this.removals, a = this.scenes, n = a.length, r = 0, i;
    r < e;
    r++) {
    i = o[r];
    for (var c = 0;
      c < n;
      c++)if (i == a[c]) {
      i.release(),
      a.splice(c, 1),
      n--;
      break
    }}this.removals = []}, b5.App.prototype.findScene = function(e) {
  for (var o = this.scenes, a = o.length, n = 0;
    n < a;
    n++)if (o[n].name == e)return o[n];
  return null
}, 
/*
 Adding resources to app has been removed.
 Instead, add resources to your scenes, you'll have at least one.
*/
//Instead, adding a global resource loaded method for every scene
 b5.App.prototype.areResourcesLoaded = function() {
   for(var i=0, e=this.scenes; i<e.length;i++) 
     if(!e[i].areResourcesLoaded()) return !1;
   return !0;
},
 b5.App.prototype.onResourceLoadedBase = function(e, t) {
  e.preload && b5.app.total_loaded++,
  t?(e.preload && b5.app.total_load_errors++, console.log('Error loading resource '+e.name)): this.debug && console.log('Resource loaded '+e.name),
  e.loaded=!0,
  e.parent && e.parent.tryLoadNextResource();
},
 b5.App.prototype.draw = function() {
  for (var e = this.scenes, o = e.length, a = 0; a < o;a++)e[a].draw()}, b5.App.prototype.update = function(e) {
  var o = b5.app,
  a = this.scenes,
  n = a.length;
  if (o.dt = e, o.timelines.update(e), void 0 !== o.actions && o.actions.execute(), o.tasks.execute(), null !== this.world) {
    if (0 === this.time_step)this.world.Step(e, 10, 10);
    else {
      var r = 1;
      this.adaptive_physics && (r = this.target_frame_rate/(1/this.adt)+.5<<0, 1 > r?r = 1: 3 < r && (r = 3));
      for (var i = 0;
        i < r;
        i++)this.world.Step(this.time_step, 10, 10)}/*null !== this.world && this.world.ClearForces()*/}for (var i = 0;
    i < n;
    i++)a[i].update(e);
  this.cleanupDestroyedScenes(),
  this.order_changed && (this.order_changed=!1, b5.Utils.sortLayers(this.scenes))
 }, 
 b5.App.prototype.mainLogic = function() {
 	b5.app.now = performance.now();
  var e = b5.app,
  t = e.now,
  o = t-e.last_time;
  e.last_time = t,
  e.adt = o < 1 ? 1/60 : o/1e3;
  var a;
  a = 0 === e.target_frame_rate?e.adt: 1/e.target_frame_rate,
  //If the app is running slow, it has a locking for minimum speed, and runs in slow motion, this can be a problem for rythm games. Setting it as optional:
  1 < a && (a = 1);
  //Gamepad update input listeners
  for(var i=0, n = b5.Gamepad.listeners, r = n.length > 0 && navigator.getGamepads(); i < n.length; i++)
    n[i].update(r[n[i].gamepad_index]);
    
  e.update(a),
  //Cursor hiding time
  this.hide_cursor && (this._cursor_hide_time_counter < this.cursor_hide_time ? this._cursor_hide_time_counter+=this.dt*1e3 : this.canvas.style.cursor != 'none' && this.setCursor('none')),
    
  this.avg_time = t,
  this.a_avg_fps = 0.97*this.a_avg_fps + 0.03*1000/(this.avg_time-this.avg_frame);  
  this.avg_frame = this.avg_time,
  this.avg_fps = Math.round(this.a_avg_fps);
  
  e.num_logic++
}, 
b5.App.prototype.mainDraw = function() {
  var e = b5.app,
  r = e.display,
  i = e.canvas.width,
  s = e.canvas.height,
  n = null;
  e.mainLogic(),
  e.clear_canvas && r.clear(e.pixel_ratio),
  r.context.start2D && r.context.start2D(),
  e.draw(),
  r.context.finish2D && r.context.finish2D(),
  e.num_draw++,
  //Moving canvas position and scaling methods to onResizeBase
  e.force_rescaling && e.onResizeBase(),
  //If offscreen rendering, copy rendered image to main canvas
  e.offscreen_rendering && (
   n = r.context_primary,
   n.resetTransform(), 
   r.setSmoothing(e.canvas_smoothing),
   n.imageSmoothingEnabled = e.canvas_smoothing,
   e.clear_canvas && n.clearRect(0,0,i,s),
   n.globalAlpha = 1,
   n.drawImage(r.offscreen_canvas,0,0,i,s)
   ),
   
  e.onTick && e.onTick(),
  e.active && ( e.vsync ? requestAnimationFrame(e.mainDraw) : setTimeout(e.mainDraw,1e3/e.fps_limit));
}, 
  b5.App.prototype.start = function() {
  this.onResizeBase(),
  requestAnimationFrame(this.mainDraw),
  this.dirty()}, b5.App.prototype.findHitActor = function(e) {
  var t = null;
  return null !== this.focus_scene && (t = this.focus_scene.findHitActor(e)),
  null === t && null !== this.focus_scene2 && (t = this.focus_scene2.findHitActor(e)),
  t
}, b5.App.prototype.dirty = function() {
  for (var e = this.scenes, o = e.length, a = 0;
    a < o;
    a++)e[a].dirty()}, 
  b5.App.prototype.setCanvasPosition = function(e,t) {
    var o = this.canvas.style;
    o.left = e + 'px',
    o.top = t + 'px';
  },
  b5.App.prototype.setResolution = function(e,t) {
      //Execute after one frame
    b5.Utils.RunafterTime(1e-2,function(){
      var o = b5.app, a = o.display.offscreen_canvas, n = o.display,
      r = b5.Utils.GetDevicePixelRatio();
      o.adapt_resolution && (
        e > innerWidth*r ? (e = innerWidth*r, t = e * (9/16)) :
        t > innerWidth*r && (t = innerHeight*r, e = t * (16/9))
      );
      n.setResolution(e,t);
      a.width > e && ( a.width = e ),
      a.height > t && ( a.height = t ),
      o.display_width = e,
      o.display_height = t,
      o.onResizeBase(),
      window.resizeTo(e,t);
    });
  },
  b5.App.prototype.setOffscreenCanvasResolution = function(e,t) {
    //Execute after one frame
    b5.Utils.RunafterTime(1e-2,function(){
      var o = b5.app, a = o.display.offscreen_canvas;
      a.width = e,
      a.height = t,
      o.setOffscreenCanvasScalingMethod();
    });
  }, 
  b5.App.prototype.setBackgroundColor = function(e){
    this.canvas.style.backgroundColor = e;
  },
  b5.App.prototype.getCanvasPoint = function(e, t) {
  var o = b5.app,
  a = o.canvas_scale;
  return {
    x: (e-this.canvas.offsetLeft-o.canvas_cx)/a,
    y: (t-this.canvas.offsetTop-o.canvas_cy)/a
  }},
  b5.App.prototype.setCanvasScalingMethod = function(e) {
  void 0 !== e && (this.canvas_scale_method = e);
  var t = this.design_width,
  o = this.design_height,
  a = b5.Display.getWidth(),
  n = b5.Display.getHeight(),
  f = this.display;
  if (!this.fill_screen) {
    var r=!0;
    switch (this.canvas_scale_method) {
      case b5.App.FitX: r=!0;
        break;
      case b5.App.FitY: r=!1;
        break;
      case b5.App.FitBest: r=!!(a/t < n/o);
        break;
      case b5.App.FitGreatest: r=!!(a > n);
        break;
      case b5.App.FitSmallest: r=!!(a < n);
        break;
      case b5.App.FitBest2: r=!!(a/t > n/o);
    }r?n = a*this.design_height/this.design_width: a = n*this.design_width/this.design_height
  };
  this.inner_width = a,
  this.inner_height = n;
  var i = t,
  s = o,
  c = 1,
  d = 1;
  if (this.canvas_scale = this.global_scale, this.canvas_scale_method === b5.App.FitNone);
  else if (this.canvas_scale_method === b5.App.FitSize)i = a,
  s = n;
  else {
    i = a,
    s = n,
    c = i/t,
    d = s/o;
    var p = 1;
    switch (this.canvas_scale_method) {
      case b5.App.FitX: p = c;
      //Set pixel ratio to relation of canvas width and client width
        this.pixel_ratio = f.canvas.width/window.innerWidth;
        break;
      case b5.App.FitY: p = d;
      //Set pixel ratio to relation of canvas height and client height
        this.pixel_ratio = f.canvas.height/window.innerHeight;
        break;
      case b5.App.FitBest:
        p = c < d?c: d;
        this.pixel_ratio = +this.canvas.style.height.split('px')[0]<window.innerHeight? f.canvas.width/window.innerWidth : f.canvas.height/window.innerHeight;
        break;
      case b5.App.FitGreatest: p = i > s?c: d;
        break;
      case b5.App.FitSmallest: p = i < s?c: d;
        break;
      case b5.App.FitBest2: p = c > d?c: d;
    }
  this.canvas_scale = p*this.global_scale
  }var l = 0|i*this.pixel_ratio,
  y = 0|s*this.pixel_ratio;
  
  //Resolution changes wrongly when increasing/decreasing viewport
  //this.canvas.width = l,
  //this.canvas.height = y,
  this.canvas.style.width = i+'px',
  this.canvas.style.height = s+'px',
  this.canvas_cx = i/2,
  this.canvas_cy = s/2,
  this.dirty()},
  b5.App.prototype.setOffscreenCanvasScalingMethod = function(e) {
    var t = this.display.offscreen_canvas;
    e && (this.canvas_pixel_ratio = e),
    this.pixel_ratio = t.height/this.canvas.height,
    this.canvas_cx = (t.width/2)/this.pixel_ratio,
    this.canvas.cy = (t.height/2)/this.pixel_ratio,
    this.canvas_scale = 0.67; //Magic number?
  },
   b5.App.prototype.setDesignSize = function(e,t){
     var o = b5.app;
     o.design_width = e,
     o.design_height = t,
     o.onResizeBase();
   },
   //NEW: App pause and resume
   b5.App.prototype.pause = function(e) {
     this.active=!1;
     !e && (this.paused=!0);
   },
   b5.App.prototype.resume = function() {
   	//Wait some time for animationFrame to respond
   	if(!this.active && this.visible)
   	  setTimeout(function() {
   		  var e = b5.app;
        e.active=!0;
        e.paused=!1;
        e.mainDraw();
   	  },100);
   }, b5.App.prototype.addTask = function(e, t, o, a, n) {
  return this.tasks.add(e, t, o, a, n)}, b5.App.prototype.removeTask = function(e) {
  this.tasks.remove(e)}, b5.App.prototype.initWorld = function(e, t, o) {
  if (this.box2d) {
    this.world = new Box2D.Dynamics.b2World(new Box2D.Common.Math.b2Vec2(e, t), o);
    var a = new Box2D.Dynamics.b2ContactListener;
    a.BeginContact = function(e) {
      var t = e.GetFixtureA().GetBody().GetUserData();
      void 0 !== t.onCollisionStart && t.onCollisionStart(e),
      t = e.GetFixtureB().GetBody().GetUserData(),
      void 0 !== t.onCollisionStart && t.onCollisionStart(e)},
    a.EndContact = function(e) {
      var t = e.GetFixtureA().GetBody().GetUserData();
      void 0 !== t.onCollisionEnd && t.onCollisionEnd(e),
      t = e.GetFixtureB().GetBody().GetUserData(),
      void 0 !== t.onCollisionEnd && t.onCollisionEnd(e)},
    this.world.SetContactListener(a)}}, 'use strict', b5.Scene = function() {
  this.app = null,
  this.actors = [],
  this.removals = [],
  this.data = {},
  this.world = null,
  this.timelines = new b5.TimelineManager(this),
  b5.ActionsListManager !== void 0 && (this.actions = new b5.ActionsListManager),
  this.tasks = new b5.TasksManager,
  this.events = new b5.EventsManager,
  this.order_changed=!0,
  this.name = '',
  this.tag = '',
  this.active=!0,
  this.visible=!0,
  this.layer = 0,
  this.x = 0,
  this.y = 0,
  this.w = 1280,
  this.h = 720,
  this.scale = 1,
  this.clip_children=!0,
  this.focus_actor = null,
  this.clip_shape = null,
  this.camera_x = 0,
  this.camera_y = 0,
  this.camera_vx = 0,
  this.camera_vy = 0,
  this.vx_damping = 1,
  this.vy_damping = 1,
  this.follow_speed_x = .3,
  this.follow_speed_y = .3,
  this.target_x = null,
  this.target_y = null,
  this.touch_pan_x=!1,
  this.touch_pan_y=!1,
  this.panning=!1,
  this.min_panning = 0,
  this.world_scale = 20,
  this.time_step = 0,
  this.extents = [0,
    0,
    0,
    0],
  this.opacity = 1,
  this.frame_count = 0,
  this.touching=!1,
  this.touchmove=!1,
  this.draw_reverse=!1,
  this.bitmaps = [],
  this.brushes = [],
  this.shapes = [],
  this.materials = [],
  this.sounds = [],
  this.fonts = [],
  this.raw = []}, Object.defineProperty(b5.Scene.prototype, '_x', {
    get: function() {
      return this.x
    }, set: function(e) {
      this.x !== e && (this.x = e)}}), Object.defineProperty(b5.Scene.prototype, '_y', {
    get: function() {
      return this.y
    }, set: function(e) {
      this.y !== e && (this.y = e)}}), Object.defineProperty(b5.Scene.prototype, '_layer', {
    get: function() {
      return this.layer
    }, set: function(e) {
      this.layer !== e && (this.layer = e, this.app.order_changed=!0)}}), Object.defineProperty(b5.Scene.prototype, '_clip_shape', {
    get: function() {
      return this.clip_shape
    }, set: function(e) {
      this.clip_shape !== e && (this.clip_shape = b5.Utils.resolveResource(e, 'shape'))}}), Object.defineProperty(b5.Scene.prototype, '_av', {
    set: function(e) {
      this.visible = e, this.active = e
    }}), b5.Scene.prototype.release = function(t) {
  for (var e = 0;
    e < this.actors.length;
    e++)this.actors[e].release();
  this.onDestroy !== void 0 && this.onDestroy(),
  this.world = null,
  t && (this.actors = null)
}, b5.Scene.prototype.destroy = function() {
  this.app.removeScene(this)}, b5.Scene.prototype.addActor = function(e) {
  return this.actors.push(e),
  e.scene = this,
  e
}, b5.Scene.prototype.removeActor = function(e) {
  this.removals.push(e)}, b5.Scene.prototype.removeActorsWithTag = function(e) {
  for (var o = this.actors, a = o.length, n = this.removals, r = 0;
    r < a;
    r++)o[r].tag === e && n.push(o[r])}, b5.Scene.prototype.cleanupDestroyedActors = function() {
  var e = this.removals.length;
  if (0 < e)for (var o = this.removals, a = this.actors, n = a.length, r = 0, i;
    r < e;
    r++) {
    i = o[r];
    for (var c = 0;
      c < n;
      c++)if (i === a[c]) {
      i.release(),
      a.splice(c, 1),
      n--;
      break
    }}this.removals = []}, b5.Scene.prototype.findActor = function(e, o) {
  o === void 0 && (o=!1);
  for (var a = this.actors, n = a.length, r = 0;
    r < n;
    r++) {
    if (a[r].name === e)return a[r];
    if (o) {
      var i = a[r].findActor(e, o);
      if (null !== i)return i
    }}return null
}, b5.Scene.prototype.findActorById = function(e, o) {
  o === void 0 && (o=!1);
  for (var a = this.actors, n = a.length, r = 0;
    r < n;
    r++) {
    if (a[r].id === e)return a[r];
    if (o) {
      var i = a[r].findActorById(e, o);
      if (null !== i)return i
    }}return null
}, b5.Scene.prototype.bringToFront = function() {
  for (var e = this.app.scenes, o = e.length, a=-1, n = 0;
    n < o;
    n++)if (e[n] === this) {
    a = n;
    break
  }0 <= a && (e.splice(a, 1), e.push(this))}, b5.Scene.prototype.sendToBack = function() {
  for (var e = this.app.scenes, o = e.length, a=-1, n = 0;
    n < o;
    n++)if (e[n] === this) {
    a = n;
    break
  }0 <= a && (e.splice(a, 1), e.unshift(this))}, b5.Scene.prototype.onKeyPressBase = function(e) {
  this.onKeyPress !== void 0 && this.onKeyPress(e)}, b5.Scene.prototype.onKeyDownBase = function(e) {
  this.onKeyDown !== void 0 && this.onKeyDown(e)}, b5.Scene.prototype.onKeyUpBase = function(e) {
  this.onKeyUp !== void 0 && this.onKeyUp(e)}, b5.Scene.prototype.onBeginTouchBase = function(e,t) {
  this.touching=!0,
  this.onBeginTouch !== void 0 && this.onBeginTouch(e,t)}, b5.Scene.prototype.onEndTouchBase = function(e,t) {
  this.touching && this.onTapped !== void 0 && this.onTapped(e,t),
  this.touching=!1,
  this.touchmove=!1,
  this.onEndTouch !== void 0 && this.onEndTouch(e,t),
  this.panning=!1
}, b5.Scene.prototype.onMoveTouchBase = function(e,p,a) {
  if (this.touchmove=!0, void 0 !== this.onMoveTouch && this.onMoveTouch(e,p,a), this.touching) {
    var t = this.app,
    o = 0;
    this.touch_pan_x && (o = t.touch_drag_x, this.camera_vx = o*t.target_frame_rate, this.camera_x += o),
    this.touch_pan_y && (o = t.touch_drag_y, this.camera_vy = o*t.target_frame_rate, this.camera_y += o),
    t.touch_drag_x*t.touch_drag_x+t.touch_drag_y*t.touch_drag_y > this.min_panning && (this.panning=!0)}}, b5.Scene.prototype.onWheelBase = function(t) {
  this.onWheel !== void 0 && this.onWheel(t), this.focus_actor !== null && this.focus_actor.onWheel && this.focus_actor.onWheel(t)}, b5.Scene.prototype.initWorld = function(e, t, o) {
  if (this.app.box2d) {
    if (this.app.shared_world)return null === this.app.world && this.app.initWorld(e, t, o),
    void(this.world = this.app.world);
    this.world = new Box2D.Dynamics.b2World(new Box2D.Common.Math.b2Vec2(e, t), o);
    var a = new Box2D.Dynamics.b2ContactListener;
    a.BeginContact = function(e) {
      var t = e.GetFixtureA().GetBody().GetUserData();
      void 0 !== t.onCollisionStart && t.onCollisionStart(e),
      t = e.GetFixtureB().GetBody().GetUserData(),
      void 0 !== t.onCollisionStart && t.onCollisionStart(e)},
    a.EndContact = function(e) {
      var t = e.GetFixtureA().GetBody().GetUserData();
      void 0 !== t.onCollisionEnd && t.onCollisionEnd(e),
      t = e.GetFixtureB().GetBody().GetUserData(),
      void 0 !== t.onCollisionEnd && t.onCollisionEnd(e)},
    this.world.SetContactListener(a)}}, b5.Scene.prototype.draw = function() {
  if (this.visible && this.opacity) { this.onChildrenDrawStart && this.onChildrenDrawStart();
    var e = this.app,
    o = e.canvas_scale*this.scale,
    a = e.display;
    if (this.clip_children) {
      var n = e.canvas_cx+this.x,
      r = e.canvas_cy+this.y;
      if (a.setTransform(o, 0, 0, o, n, r), a.saveContext(), null === this.clip_shape)a.clipRect(-this.w/2, -this.h/2, this.w, this.h);
      else {
        var i = this.clip_shape;
        this.clip_shape.type === b5.Shape.TypeBox?a.clipRect(0, 0, i.width, i.height): this.clip_shape.type === b5.Shape.TypeCircle?a.clipArc(0, 0, i.width, 0, 2*Math.PI): this.clip_shape.type === b5.Shape.TypePolygon && a.clipPolygon(i.vertices)}}
        var s = this.actors,
    c = s.length;
    if (this.draw_reverse)for (var d = c-1;
      0 <= d;
      d--)s[d].draw();
    else for (var d = 0;
      d < c;
      d++)s[d].draw();
    this.clip_children && a.restoreContext();
    this.onDraw && this.onDraw();
    this.onChildrenDrawEnd && this.onChildrenDrawEnd()
  }
}, b5.Scene.prototype.baseUpdate = function(e) {
  if (!this.active)return!1;
  void 0 !== this.onTick && this.onTick(e),
  this.timelines.update(e),
  void 0 !== this.actions && this.actions.execute(),
  this.tasks.execute(),
  this.updateCamera(e);
  for (var o = this.actors, a = o.length, n = 0;
    n < a;
    n++)o[n].update(e);
  if (null !== this.world && null === b5.app.world) {
    var r = b5.app;
    if (0 === this.time_step)this.world.Step(e, 10, 10);
    else {
      var i = 1;
      r.adaptive_physics && (i = 10); //(i = 60/(1/r.adt)+.5<<0, 1 > i?i = 1: 3 < i && (i = 3));
      for (var n = 0;
        n < i;
        n++)this.world.Step(this.time_step/i, 1, 1)}null !== this.world && this.world.ClearForces()}return this.frame_count++,
  this.cleanupDestroyedActors(),
  this.order_changed && (this.order_changed=!1, b5.Utils.sortLayers(this.actors)),
  !0
}, b5.Scene.prototype.update = function(e) {
  return this.baseUpdate(e)}, b5.Scene.prototype.updateCamera = function(e) {
  if (null !== this.target_x && (0 === this.follow_speed_x?(this.camera_x = this.target_x.x, this.camera_vx = 0): this.camera_vx += (this.target_x.x-this.camera_x)*this.follow_speed_x), null !== this.target_y && (0 === this.follow_speed_y?(this.camera_y = this.target_y.y, this.camera_vy = 0): this.camera_vy += (this.target_y.y-this.camera_y)*this.follow_speed_y), this.touching || (this.camera_x += this.camera_vx*e, this.camera_y += this.camera_vy*e, this.camera_vx *= this.vx_damping, this.camera_vy *= this.vy_damping), 0 !== this.camera_x || 0 !== this.camera_y) {
    var t = this.extents[2],
    o = this.extents[3],
    a = this.app.design_width,
    n = this.app.design_height;
    if (0 !== t && a <= t) {
      var r = a/2,
      i = this.extents[0]+r,
      s = this.extents[0]+t-r;
      this.camera_x < i && (this.camera_x = i, this.camera_vx = 0),
      this.camera_x > s && (this.camera_x = s, this.camera_vx = 0)}if (a > t && (this.camera_x = 0), 0 !== o && n <= o) {
      var c = n/2,
      d = this.extents[1]+c,
      p = this.extents[1]+o-c;
      this.camera_y < d && (this.camera_y = d, this.camera_vy = 0),
      this.camera_y > p && (this.camera_y = p, this.camera_vy = 0)}n > o && (this.camera_y = 0)}
  }, b5.Scene.prototype.findHitActor = function(e,i) {
  for (var o = this.actors, a = o.length, n = null, r = a-1;
    0 <= r;
    r--)if (n = o[r].hitTest(e,i), null !== n)return n;
  return n
}, b5.Scene.prototype.dirty = function() {
  for (var e = this.actors, o = e.length, a = 0;
    a < o;
    a++)e[a].dirty()}, b5.Scene.prototype.addResource = function(e, t, a) {
  if (t === void 0)throw'Resource type not specified';
  var o = b5.Utils.getResFromType(this, t);
  e.persist = a;
  null !== o && (o.push(e), e.parent = this);
}, b5.Scene.prototype.removeResource = function(e, o) {
  var a = b5.Utils.getResFromType(this, o);
  if (null !== a)for (var n = a.length, r = 0;
    r < n;
    r++)if (a[r] === e)return a.parent = null,
  void a.splice(r, 1)}, 
  //NEW
  b5.Scene.prototype.removeResourceByName =	function(e,o){
   var a = b5.Utils.getResFromType(this, o);
    if (null !== a)for (var n = a.length, r = 0; r < n; r++)if (a[r].name == e)return a.parent = null, a[r].destroy(!0),
    void a.splice(r, 1);
  },
  b5.Scene.prototype.tryLoadNextResource = function() {
  	var e = [this.bitmaps,this.brushes,this.fonts,this.raw,this.sounds];
    for(var t=0;t<e.length;t++)
      for(var o=0; o<e[t].length;o++){var a = e[t][o];
        if(!a.loaded && !a.preload && !a.loading && a.load) return a.load(), !0;
      }
    return !1;
  },
  b5.Scene.prototype.loadResources = b5.Scene.prototype.tryLoadNextResource,
  
  b5.Scene.prototype.playTimeline = function(e) {
  this.active || (this.active=!0, this.visible=!0);
  var t = this.timelines.find(e);
  null !== t && t.restart()}, b5.Scene.prototype.addTask = function(e, t, o, a, n) {
  this.tasks.add(e, t, o, a, n)}, b5.Scene.prototype.removeTask = function(e) {
  this.tasks.remove(e)}, b5.Scene.prototype.findResource = function(e, o) {
  var a = b5.Utils.getResFromType(this, o);
  if (null === a)return null;
  for (var n = a.length, r = 0;
    r < n;
    r++)if (a[r].name === e)return a[r];
  return null}, b5.Scene.prototype.areResourcesLoaded = function(e) {
    //Resources loaded detection is bad. Fixing it.
    for (var o = this.bitmaps, a = o.length, n = 0;
    n < a;
    n++)if(!o[n].loaded)return !1;
  for (o = this.sounds, a = o.length, n = 0;
    n < a;
    n++)if(!o[n].loaded)return !1;
  for (o = this.fonts, a = o.length, n = 0;
    n < a;
    n++)if(!o[n].loaded)return !1;
  for (o = this.raw, a = o.length, n = 0;
    n < a;
    n++)if(!o[n].loaded)return !1;
  return !0;
}, b5.Scene.prototype.destroyAllResources = function() {
	var t = [this.bitmaps,this.brushes,this.fonts,this.raw,this.sounds];
    for(var o=0;o<t.length;o++) 
      for(var r=0;t[o].length>r;) !t[o][0].persist ? t[o][0].destroy() : r++;
}, b5.Scene.prototype.countResourcesNeedLoading = function() {
  for (var e = 0, o = this.bitmaps, a = o.length, n = 0;
    n < a;
    n++)o[n].preload && e++;
  for (o = this.sounds, a = o.length, n = 0;
    n < a;
    n++)o[n].preload && e++;
  for (o = this.fonts, a = o.length, n = 0;
    n < a;
    n++)o[n].preload && e++;
  for (o = this.raw, a = o.length, n = 0;
    n < a;
    n++)o[n].preload && e++;
  return e
}, //New
 b5.Scene.prototype.countLoadedResources = function() {
  for (var e = 0, o = this.bitmaps, a = o.length, n = 0;
    n < a;
    n++)o[n].loaded && e++;
  for (o = this.sounds, a = o.length, n = 0;
    n < a;
    n++)o[n].loaded && e++;
  for (o = this.fonts, a = o.length, n = 0;
    n < a;
    n++)o[n].loaded && e++;
  for (o = this.raw, a = o.length, n = 0;
    n < a;
    n++)o[n].loaded && e++;
  return e
 },
'use strict', b5.Maths = function() {}, b5.Maths.mulMatrix = function(e, t) {
  var o = t[0],
  a = t[1],
  n = t[2],
  r = t[3],
  i = t[4],
  s = t[5],
  c = e[0],
  d = e[1],
  p = e[2],
  l = e[3],
  y = e[4],
  _ = e[5];
  e[0] = o*c+n*d,
  e[1] = a*c+r*d,
  e[2] = o*p+n*l,
  e[3] = a*p+r*l,
  e[4] = o*y+n*_+i,
  e[5] = a*y+r*_+s
}, b5.Maths.preMulMatrix = function(e, t) {
  var o = e[0],
  a = e[1],
  n = e[2],
  r = e[3],
  i = e[4],
  s = e[5],
  c = t[0],
  d = t[1],
  p = t[2],
  l = t[3],
  y = t[4],
  _ = t[5];
  e[0] = o*c+n*d,
  e[1] = a*c+r*d,
  e[2] = o*p+n*l,
  e[3] = a*p+r*l,
  e[4] = o*y+n*_+i,
  e[5] = a*y+r*_+s
},
b5.Maths.vecMulMatrix = function(e, t, o) {
  var a = e*o[0]+t*o[2]+o[4],
  n = e*o[1]+t*o[3]+o[5];
  return {
    x: a,
    y: n
  }
},
//New: More random number functions
b5.Maths.randomRange = function(min, max) {
  return min + Math.round(Math.random()*(max-min));
};
b5.Maths.randomChance = function(prcnt) {
  return prcnt + Math.random() > 1 ? 1 : 0;
}, 
//Utilities
b5.Maths.radToDeg = function(rad) {
	return rad * 180 / Math.PI;
},
b5.Maths.degToRad = function(deg) {
	return deg * Math.PI / 180;
},
b5.Maths.cap = function(e, t, o) {
	e > o ? e = o : e < t && (e = t);
	return e;
},
'use strict', b5.Display = function(e, t, o) {
  this.cache_ctx = null,
  e === b5.app.canvas ? (
  	this.offscreen_ctrl = e.transferControlToOffscreen ? e.transferControlToOffscreen() : (console.log("transferControlToOffscreen not available, app may stutter a lot."), e),
  this.context = window.enableWebGLCanvas ? enableWebGLCanvas(this.offscreen_ctrl) : this.offscreen_ctrl.getContext('2d',t)) : this.context = e.getContext("2d", t),
  this.canvas = this.context.canvas;
  this.context.lineWidth = 1,
  this.context.strokeStyle = 'black',
  this.context.fillStyle = 'black',
  this.context.globalAlpha = 1,
  this.context.lineJoin = 'round',
  this.context.lineCap = 'round',
  !o && (this.display_scale = 1);
}, b5.Display.getWidth = function() {
  return document.documentElement.clientWidth
}, b5.Display.getHeight = function() {
  return document.documentElement.clientHeight
},
b5.Display.setBackgroundColor = function(e){
  document.body.style.backgroundColor = e;
},
b5.Display.prototype.clear = function(o) {
  var t = this.context,
  e = t.canvas;
  t.setTransform(o||1, 0, 0, o||1, 0, 0),
  t.clearRect(0, 0, e.width, e.height)}, b5.Display.prototype.drawPolygon = function(e, t, o, a) {
  var n = this.context;
  null !== this.cache_ctx && (n = this.cache_ctx);
  var r = o.length;
  n.beginPath(),
  n.moveTo(o[0]+e, o[1]+t);
  for (var s = 2;
    s < r;
    s += 2)n.lineTo(o[s]+e, o[s+1]+t);
  return a?n.fill(): (n.lineTo(o[0]+e, o[1]+t), n.stroke()),
  this
}, //Resolution
  b5.Display.prototype.setResolution = function(e,t) {
    var o = this.canvas;
    o.width = e,
    o.height = t;
  }, 
  b5.Display.prototype.drawLine = function(e, t, o, a) {
  var n = this.context;
  return null !== this.cache_ctx && (n = this.cache_ctx),
  n.beginPath(),
  n.moveTo(e, t),
  n.lineTo(o, a),
  n.stroke(),
  this
}, b5.Display.prototype.drawRect = function(e, t, o, a, n) {
  var r = this.context;
  return null !== this.cache_ctx && (r = this.cache_ctx),
  n?r.fillRect(e, t, o, a): r.strokeRect(e, t, o, a),
  this
}, b5.Display.prototype.drawRoundRect = function(e, t, o, a, n, r) {
  var i = this.context;
  null !== this.cache_ctx && (i = this.cache_ctx),
  i.beginPath(),
  i.moveTo(e+n, t),
  i.lineTo(e+o-n, t),
  i.quadraticCurveTo(e+o, t, e+o, t+n),
  i.lineTo(e+o, t+a-n),
  i.quadraticCurveTo(e+o, t+a, e+o-n, t+a),
  i.lineTo(e+n, t+a),
  i.quadraticCurveTo(e, t+a, e, t+a-n),
  i.lineTo(e, t+n),
  i.quadraticCurveTo(e, t, e+n, t),
  i.closePath(),
  r?i.fill(): i.stroke()}, b5.Display.prototype.drawArc = function(e, t, o, a, n, r) {
  var i = this.context;
  return null !== this.cache_ctx && (i = this.cache_ctx),
  i.beginPath(),
  i.arc(e, t, o, a, n),
  r?i.fill(): i.stroke(),
  this
}, 
  b5.Display.prototype.loadImage = function(e) {
  	this.drawAtlasImage(e,0,0,1,1,0,0,1,1);
},
  b5.Display.prototype.drawAtlasImage = function(e, t, o, a, n, r, i, s, c) {
  if (!(0 >= e.width || 0 >= e.height)) {
    var d = this.context;
    null !== this.cache_ctx && (d = this.cache_ctx),
    d.drawImage(e, t, o, a, n, r, i, s, c)}}, b5.Display.prototype.drawImage = function(e, t, o, a, n) {
  if (!(0 >= e.width || 0 >= e.height)) {
    var r = this.context;
    null !== this.cache_ctx && (r = this.cache_ctx),
    void 0 === a?r.drawImage(e, t, o): r.drawImage(e, t, o, a, n)}
}, b5.Display.prototype.drawText = function(e, o, a, n, r) {
  var i = this.context;
  null !== this.cache_ctx && (i = this.cache_ctx),
  e = ''+e;
  for (var s = e.split('\n'), c = 0, d = 0;c < s.length;c++){
  	var m = i.measureText(s[c]).width;
   	r?i.fillText(s[c], o, a): i.strokeText(s[c], o, a),
    a += n,
    m > d && (d = m);
  }return d
}, b5.Display.prototype.drawTextWrap = function(e, o, a, n, r, i, s) {
  if (0 === n)return this.drawText(e, o, a, r, i);
  e = ''+e;
  var c = this.measureTextLines(e, n);
  1 < c && 'middle' === s && (a -= r*c/2-r/2);
  var d = this.context;
  null !== this.cache_ctx && (d = this.cache_ctx);
  for (var p = e.split('\n'), l = 0;
    l < p.length;
    l++) {
    for (var _ = '', q = 0, u = p[l].split(' '), h = 0;
      h < u.length;
      h++) {
      var g = _+u[h]+' ',
      m = d.measureText(g);
      m > q && (q = m);
      m.width > n?(i?d.fillText(_, o, a): d.strokeText(_, o, a), _ = u[h]+' ', a += r): _ = g
    }i?d.fillText(_, o, a): d.strokeText(_, o, a),
    a += r; return q}
}, b5.Display.prototype.measureText = function(e) {
  var t = this.context;
  return null !== this.cache_ctx && (t = this.cache_ctx),
  t.measureText(e)}, b5.Display.prototype.measureTextLines = function(e, o) {
  if (0 === o)return 1;
  var a = this.context;
  null !== this.cache_ctx && (a = this.cache_ctx);
  for (var n = e.split('\n'), r = 0, i = 0;
    i < n.length;
    i++) {
    for (var s = '', c = n[i].split(' '), d = 0;
      d < c.length;
      d++) {
      var p = s+c[d]+' ',
      l = a.measureText(p);
      l.width > o?(s = c[d]+' ', r++): s = p
    }r++
  }return r
}, b5.Display.prototype.setTransform = function(e, t, o, a, n, r) {
  var i = this.display_scale || b5.app.pixel_ratio;
  e *= i,
  t *= i,
  o *= i,
  a *= i,
  n *= i,
  r *= i;
  var s = this.context;
  null !== this.cache_ctx && (s = this.cache_ctx),
  s.setTransform(e, t, o, a, n, r)
},
b5.Display.prototype.setTransform2 = function(scale_x, skew_y, skew_x, scale_y, pos_x, pos_y) {
  var i = this.display_scale || b5.app.pixel_ratio,
  e = scale_x, t = skew_y, o = skew_x, a =	scale_y, n = pos_x, r = pos_y;
  e *= i,
  t *= i,
  o *= i,
  a *= i,
  n *= i,
  r *= i;
  var s = this.context;
  null !== this.cache_ctx && (s = this.cache_ctx),
  s.setTransform(e, t, o, a, n, r)
},
b5.Display.prototype.clipRect = function(e, t, o, a) {
  var n = this.context;
  null !== this.cache_ctx && (n = this.cache_ctx),
  n.beginPath(),
  n.rect(e, t, o, a),
  n.clip()}, b5.Display.prototype.clipArc = function(e, t, o, a, n) {
  var r = this.context;
  null !== this.cache_ctx && (r = this.cache_ctx),
  r.beginPath(),
  r.arc(e, t, o, a, n),
  r.clip()}, b5.Display.prototype.clipPolygon = function(e) {
  var t = this.context;
  null !== this.cache_ctx && (t = this.cache_ctx),
  t.beginPath();
  var o = e.length;
  t.moveTo(e[0], e[1]);
  for (var a = 2;
    a < o;
    a += 2)t.lineTo(e[a], e[a+1]);
  t.closePath(),
  t.clip()}, b5.Display.prototype.saveContext = function() {
  var e = this.context;
  //null !== this.cache_ctx && (e = this.cache_ctx),
  e.save()}, b5.Display.prototype.restoreContext = function() {
  var e = this.context;
  //null !== this.cache_ctx && (e = this.cache_ctx),
  e.restore()}, b5.Display.prototype.createCache = function() {
  return document.createElement('canvas')}, b5.Display.prototype.createCacheWithSize = function(e, t) {
  var o = document.createElement('canvas');
  return o.width = e,
  o.height = t,
  o
}, b5.Display.prototype.setGlobalAlpha = function(e) {
  this.context.globalAlpha = e
}, b5.Display.prototype.setGlobalCompositeOp = function(e) {
  this.context.globalCompositeOperation = e
}, b5.Display.prototype.setShadow = function(e, t, o, a) {
  var n = this.context;
  null !== this.cache_ctx && (n = this.cache_ctx),
  n.shadowOffsetX = e,
  n.shadowOffsetY = t,
  n.shadowColor = o,
  n.shadowBlur = a
}, b5.Display.prototype.setShadowOff = function() {
  var e = this.context;
  null !== this.cache_ctx && (e = this.cache_ctx),
  e.shadowColor = 'transparent'
}, b5.Display.prototype.setFillStyle = function(e) {
  var t = this.context;
  null !== this.cache_ctx && (t = this.cache_ctx),
  t.fillStyle = e
}, b5.Display.prototype.setStrokeStyle = function(e) {
  var t = this.context;
  null !== this.cache_ctx && (t = this.cache_ctx),
  t.strokeStyle = e
}, b5.Display.prototype.setLineWidth = function(e) {
  var t = this.context;
  null !== this.cache_ctx && (t = this.cache_ctx),
  t.lineWidth = e
}, b5.Display.prototype.setFont = function(e) {
  var t = this.context;
  null !== this.cache_ctx && (t = this.cache_ctx),
  t.font = e
}, b5.Display.prototype.setTextAlign = function(e) {
  var t = this.context;
  null !== this.cache_ctx && (t = this.cache_ctx),
  t.textAlign = e
}, b5.Display.prototype.setTextBaseline = function(e) {
  var t = this.context;
  null !== this.cache_ctx && (t = this.cache_ctx),
  t.textBaseline = e
}, b5.Display.prototype.setSmoothing = function(e) {
  var t = this.context;
  null !== this.cache_ctx && (t = this.cache_ctx),
  t.imageSmoothingEnabled = e,
  t.mozImageSmoothingEnabled = e,
  t.oImageSmoothingEnabled = e,
  t.imageSmoothingEnabled = e,
  t.msImageSmoothingEnabled = e
}, b5.Display.prototype.setCache = function(e) {
  this.cache_ctx = null === e?null: this.context
}, b5.Display.prototype.filter = function(e) {
  var t = '';
  for(var i in e) 
    switch(i) {
      case 'blur': 
        t += i+'('+ (+e[i] || 0) +'px) '; break;
      case 'hue': 
        t += i+'-rotate('+ (+e[i] || 0) +'deg) '; break;
      case 'brightness': 
      case 'contrast': 
      case 'saturate': 
        //Default to 100%
        t += i+'('+ Math.round(e[i]*100 || 100) +'%) '; break;
      case 'grayscale':
      case 'invert': 
      case 'sepia': 
        //Default to 0%
        t += i+'('+ (e[i]*100 || 0) +'%) '; break;
    };
  this.context.filter = t;
},
b5.App.prototype.setFilters = function(e) {
  var t = '';
  for(var i in e) 
    switch(i) {
      case 'blur': 
        e[i] != 0 && (t += i+'('+ (+e[i] || 0) +'px) '); break;
      case 'hue': 
        e[i] != 0 && (t += i+'-rotate('+ (+e[i] || 0) +'deg) '); break;
      case 'brightness': 
      case 'contrast': 
      case 'saturate': 
        //Default to 100%
        e[i] != 1 && (t += i+'('+ Math.round(e[i]*100 || 100) +'%) '); break;
      case 'grayscale':
      case 'invert': 
      case 'sepia': 
        //Default to 0%
        e[i] != 0 && (t += i+'('+ (e[i]*100 || 0) +'%) '); break;
    };
  return this.filters = e, this.canvas.style.filter = t, t;
},
'use strict', b5.Raw = function(e, t, o, a) {
  this.data = null,
  this.parent = null,
  this.name = e,
  this.type = 'raw',
  this.location = t,
  this.onload = a,
  this.preload = o,
  this.loaded=!1,
  this.load_retry = 0,
  o && this.load()}, b5.Raw.prototype.load = function() {
  var e = this;
  e.loading = !0;
  b5.Utils.loadJSON(this.location, !1, function(t) {
    e.data = t, null === t?(e.load_retry++, 3 < e.load_retry?(b5.app.onResourceLoaded(e, !0), e.onload !== void 0 && e.onload(t,!1)): e.load()): (e.loaded=!0, b5.app.onResourceLoaded(e, !1), e.onload !== void 0 && e.onload(t,!0))}, !1)}, b5.Raw.prototype.destroy = function() {
  this.data = null,
  null !== this.parent && this.parent.removeResource(this, 'raw')
  for(var i in this)this[i]=null;
}, 'use strict', 
//From this line to 3420 there were a lot of garbage code, it looked like a screen to visualize default fonts, but since fonts can be drawn directly to canvas this is not needed. Looks like this is used in the b5 game maker engine
//New: fonts now can be added and removed from document. You can use any font type file
  b5.Font = function(e, t, o, a) {
   this.font = "16pt "+t,
   this.location = o,
   this.parent = null, 
   this.name = e, 
   this.type = "font",
   this.font_name = t,
   this.preload = a, this.loaded=!1, this.load_retry = 0,
   a && this.load()},
  b5.Font.prototype.load = function() {
  var e = this, t = new FontFace(e.font_name,"url("+e.location+")");
  e.loading = !0,
  e.fontface = t;
  t.load().then(function() {
   //Add font to document
   document.fonts.add(t);
    e.loaded=!0, b5.app.onResourceLoaded(e,!1);
    e.onload !== void 0 && e.onload(e,!0);
  }, function() {
    e.load_retry++, 3 < e.load_retry?(b5.app.onResourceLoaded(e,
      !0),e.onload !== void 0 && e.onload(e,!1)): e.load()})}, 
  b5.Font.prototype.destroy = function() {
  this.data = null, null !== this.parent && this.parent.removeResource(this, 'font'),
    //Remove font from document
  this.fontface&&document.fonts.delete(this.fontface);
  //Delete object data to save memory (via GC)
  for(var i in this) this[i]=null;
  },
  'use strict', 
  b5.Bitmap = function(e, t, o, a) {
    this.image = new Image, this.image.decoding = 'async', this.parent = null, this.name = e, this.type = "bitmap", this.location = t, this.onload = a, this.preload = o, this.loaded=!1, this.load_retry = 0, o && this.load()},
  b5.Bitmap.prototype.load = function() {
  var e = this;
  e.loading = !0;
  this.image.onload = function() {
    (0 >= e.image.width || 0 >= e.image.naturalWidth || 0 >= e.image.naturalHeight||!e.image.complete)? e.onload !== void 0 && e.onload(e,!1) : (
       b5.app.onResourceLoaded(e, !1), 
       e.onload !== void 0 && e.onload(e,!0),
       /*Load image into VRAM*/
       b5.app.display.loadImage(e.image)
       )
  }, this.image.onerror = function() {
    e.load_retry++, 3 < e.load_retry?(b5.app.onResourceLoaded(e, !0), e.onload !== void 0 && e.onload(e,!1)): e.load();
  }, this.image.src = this.location
}, 
b5.Bitmap.prototype.destroy = function() {
  this.image = null, null !== this.parent && this.parent.removeResource(this, 'bitmap');
    //Delete object data to save memory (via GC)
  for(var i in this) this[i]=null;
}, 
'use strict',
/* NEW! */
b5.BitmapProcessor =	function(e,t,o) {
  this.image = new OffscreenCanvas(e,t),
  this.loaded = !0,
  this.preload = !1,
  this.type = 'bitmap',
  this.parent = null,
  this.display =	new b5.Display(this.image,o);
},
b5.BitmapProcessor.prototype.destroy = function() {
  for(var i in this)this[i] = null;
},
'use strict', 
b5.Gradient = function(e, t) {
  this.parent = null, this.stops = void 0 === t?[]: t, this.name = e
}, b5.Gradient.prototype.addColourStop = function(e, t) {
  this.stops.push({
    c: e, offs: t
  })}, b5.Gradient.prototype.getColourStop = function(e) {
  return this.stops[e]}, b5.Gradient.prototype.getMaxStops = function() {
  return this.stops.length
}, b5.Gradient.prototype.destroy = function() {
  null !== this.parent && this.parent.removeResource(this, 'brush');
  //Delete object data to save memory (via GC)
  for(var i in this) this[i]=null;
}, b5.Gradient.prototype.createStyle = function(e, o, a, n) {
  if (this.stops !== void 0) {
    var r = 0,
    i = 0,
    c = 1,
    d = 0;
    a !== void 0 && (r = a.x, i = a.y),
    n !== void 0 && (c = n.x, d = n.y),
    r = r*e-e/2,
    i = i*o-o/2,
    c = c*e-e/2,
    d = d*o-o/2;
    var p = void 0 === this.rad_pos?b5.app.display.context.createLinearGradient(r, i, c, d): b5.app.display.context.createRadialGradient(this.rad_pos[0]*e, this.rad_pos[1]*e, this.rad_radius[0]*e, this.rad_pos[2]*e, this.rad_pos[3]*e, this.rad_radius[1]*e);
    for (var l = 0, y;
      l < this.stops.length;
      l++)y = this.stops[l],
    p.addColorStop(y.offs, y.c);
    return p
  }return null
}, 'use strict', b5.ImageAtlas = function(e, t, o, a, n, r, i, s, c) {
  this.frames = [],
  this.anims = {},
  this.parent = null,
  this.name = e,
  this.type = "brush",
  this.bitmaps = t,
  o !== void 0 && a !== void 0 && n !== void 0 && r !== void 0 && this.addFrame(o, a, n, r, i, s, c)}, 
 b5.ImageAtlas.prototype.addFrame = function(i, e, t, o, a, n, r) {
  n === void 0 && (n = 0),
  r === void 0 && (r = 0),
  this.frames.push({
    bitmap: i, x: e, y: t, w: o, h: a, ox: n, oy: r
  })},
  /* New: CSV frame table */
  b5.ImageAtlas.prototype.parseFrames = function(e) {
  	var t = e.replace(/\r/g,'\n').replace(/\n\n/g,'\n').split('\n'),
  	o = t[0].split(','), r;
  	for(var i = 1, a = o.length; i < t.length; i++) {
  		t[i].trim() !== "" && !t[i].startsWith("#") && (
  	  r = t[i].split(','),
  		this.addFrame(+r[0], +r[1], +r[2], +r[3], +r[4], +r[5] || 0, +r[6] || 0)
  		);
  	}
  },
  b5.ImageAtlas.prototype.parseAnims = function(e) {
  	var t = JSON.parse(e);
  	for(var i in t) this.addAnim(i,t[i].indices || t[i].frames,t[i].speed);
  },
  b5.ImageAtlas.prototype.getFrame = function(e) {
  return this.frames[e]}, b5.ImageAtlas.prototype.getMaxFrames = function() {
  return this.frames.length}, 
 //New: get bitmaps
  b5.ImageAtlas.prototype.getBitmap = function(e){
   return this.bitmaps[e]},
 //New: count indices (return a list of indices) for all frames if anim=null, else return anim indices
  b5.ImageAtlas.prototype.getIndices = function(d) {
    var c = [];
    if(!d){ for(var i = 0, a = this.frames, b = a.length; i < b; i++)
      c.push(i);
    return c;
    } else return this.anims[d].indices;
  }, b5.ImageAtlas.prototype.addAnim = function(e, t, o) {
   this.anims[e] = {
    indices: t?t:this.getIndices(), //Add all frames if no indices
    speed: o
  }},
  b5.ImageAtlas.prototype.getAnim = function(e) {
    return this.anims[e]}, 
  b5.ImageAtlas.prototype.listAnims = function() {
  	var e = [];
  	for(var i in this.anims) e.push(i);
    return e;
  }, b5.ImageAtlas.prototype.generate = function(e, t, o, a, n, r, i) {
  i !== void 0 && (i = n*r);
  for (var s = t, c = 0, d;
    c < r;
    c++) {
    d = e;
    for (var p = 0;
      p < n;
      p++)if (this.addFrame(d, s, o, a, 0, 0), d += o, i--, 0 >= i)return;
    s += a
  }}, b5.ImageAtlas.prototype.destroy = function() {
  null !== this.parent && this.parent.removeResource(this, 'brush');
  //Delete object data to save memory (via GC)
   for(var i in this) this[i]=null;
  }, 'use strict', b5.Material = function(e) {
  this.parent = null,
  this.name = e,
  this.type = 'material',
  this.type = 'static',
  this.density = 1,
  this.friction = .1,
  this.restitution = .1,
  this.gravity_scale = 1,
  this.fixed_rotation=!1,
  this.is_bullet=!1
}, b5.Material.prototype.destroy = function() {
  null !== this.parent && this.parent.removeResource(this, 'material');
  for(var i in this) this[i]=null;
}, 'use strict', b5.Shape = function(e) {
  this.parent = null,
  this.name = e,
  this.type = 'shape',
  this.type = b5.Shape.TypeBox,
  this.width = 0,
  this.height = 0,
  this.vertices = [],
  this.convexVertices = []}, b5.Shape.TypeBox = 0, b5.Shape.TypeCircle = 1, b5.Shape.TypePolygon = 2, b5.Shape.prototype.typeToConst = function() {
  if ('polygon' === shape.type)return b5.Shape.TypePolygon;
  return'circle' === shape.type?b5.Shape.TypeCircle: b5.Shape.TypeBox
}, b5.Shape.prototype.remove = function() {
  null !== this.parent && this.parent.removeResource(this, 'shape');
  for(var i in this) this[i]=null;
}, 'use strict', b5.Utils = function() {}, b5.Utils.loadJSON = function(e, t, o, a) {
  var n = new XMLHttpRequest;
  n.open('GET', e, !t),
  n.overrideMimeType('application/json'),
  a && (n.responseType = 'arraybuffer'),
  t || (n.onreadystatechange = function() {
    4 === n.readyState && (200 === n.status || 0 === n.status?a?o(n.response): o(n.responseText): o(null))});
  try {
    n.send()}catch(t) {
    return!1
  }return t && (200 === n.status?a?o(n.response): o(n.responseText): o(null)),
  !0
}, b5.Utils.loadJS = function(e) {
  var t = document.createElement('script'); 
  t.setAttribute('type', 'text/javascript'),
  t.setAttribute('src', e),
  'undefined' != typeof t && document.getElementsByTagName('head')[0].appendChild(t);
	return t;
}, b5.Utils.SendGetRequest = function(e, t) {
  var o = new XMLHttpRequest;
  o.onreadystatechange = function() {
    t != null && t(o)},
  o.open('GET', e, !0),
  o.send()}, b5.Utils.SendPostJSONRequest = function(e, t, o) {
  var a = new XMLHttpRequest;
  a.open('POST', e, !0),
  a.setRequestHeader('Content-Type', 'application/json'),
  a.onreadystatechange = function() {
    o != null && o(a)},
  a.send(JSON.stringify(t))}, b5.Utils.findObjectFromPath = function(e, o) {
  var a = e.split('.'),
  n = a.length;
  if (0 === n)return null;
  var r = b5.app.findScene(a[0]);
  if (1 === n && void 0 === o)return r;
  if (1 < n) {
    if (void 0 === o) {
      for (var i = 1;
        i < n;
        i++)r = r.findActor(a[i]);
      return null === r?(b5.app.debug && console.log('Warning: Could not resolve object with path\''+e+'\''), null): r
    }var s = o.charAt(0);
    if ('t' == s && 'timeline' === o) {
      for (var i = 1;
        i < n-1;
        i++)r = r.findActor(a[i]);
      return null === r?(b5.app.debug && console.log('Warning: Could not resolve timeline with path\''+e+'\''), null): r.timelines.find(a[n-1])}if ('a' == s && 'actions' === o) {
      for (var i = 1;
        i < n-1;
        i++)r = r.findActor(a[i]);
      return null === r?(b5.app.debug && console.log('Warning: Could not resolve actions with path\''+e+'\''), null): r.actions.find(a[n-1])}}return b5.app.debug && console.log('Warning: Could not resolve object with path\''+e+'\''),
  null
}, b5.Utils.findResourceFromPath = function(e, t) {
  var o = e.split('.'),
  a = o.length;
  if (0 === a)return null;
  var n = b5.app;
  1 < a && (n = b5.app.findScene(e));
  var r = n.findResource(o[a-1], t);
  return null === r?(b5.app.debug && console.log('Warning: Could not resolve resource for path\''+e+'\''), null): r
}, b5.Utils.resolveObject = function(e, t) {
  return void 0 === e?null: 'string' == typeof e?b5.Utils.findObjectFromPath(e, t): e
}, b5.Utils.resolveResource = function(e, t) {
  return void 0 === e?null: 'string' == typeof e?b5.Utils.findResourceFromPath(e, t): e
}, b5.Utils.getResFromType = function(e, t) {
  var o = t.charAt(0);
  if ('b' == o) {
    if ('brush' === t)return e.brushes;
    if ('bitmap' === t)return e.bitmaps
  } else if ('s' == o) {
    if ('sound' === t)return e.sounds;
    if ('shape' === t)return e.shapes
  } else {
    if ('m' == o && 'material' === t)return e.materials;
    if ('raw' === t)return e.raw;
    if ('font' === t)return e.fonts
  }return null
}, b5.Utils.sortLayers = function(e) {
  var o = e.length, a, n;
  for (n = 0; n < o; n++)
    for (a = n+1; a < o; a++)
      if (e[n].layer > e[a].layer) {
        var r = e[n];
        e[n] = e[a],
        e[a] = r
  }}, b5.Utils.CreateCanvas = function(e, t, o, a) {
  var n = document.createElement('canvas');
  return n.id = e,
  n.width = t,
  n.style.width = t+'px',
  n.height = o,
  n.style.height = o+'px',
  n.style.zIndex = a,
  n.style.position = 'fixed',
  n.style.left = 0,
  n.style.top = 0,
  n.style.right = 0,
  n.style.bottom = 0,
  n.style.margin = 'auto',
  n.style.pointerEvents = 'auto',
  n.style.visibility = 'visible',
  document.body.appendChild(n),
  n
}, b5.Utils.GetDevicePixelRatio = function() {
  if (window.devicePixelRatio !== void 0)return window.devicePixelRatio;
  var e = window.screen;
  return e !== void 0 && e.systemXDPI !== void 0 && e.logicalXDPI !== void 0 && e.systemXDPI > e.logicalXDPI?e.systemXDPI/e.logicalXDPI: 1
}, b5.Utils.GetBackingStorePixelRatio = function(e) {
  return e.webkitBackingStorePixelRatio || e.mozBackingStorePixelRatio || e.msBackingStorePixelRatio || e.oBackingStorePixelRatio || e.backingStorePixelRatio || 1
}, b5.Utils.RunafterTime = function(e, t, o) {
  b5.app.addTask('', e, 1, t, o)}, b5.Utils.SetFullscreen = function(e) {
  document.fullscreenEnabled && (e?null == document.fullscreenElement && document.body.requestFullscreen(): null != document.fullscreenElement && document.exitFullscreen())}, 
  //Simplifying
  b5.Utils.IsMobile = function() {
  return !!navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i);
  }, b5.Utils.GetPlatform = function() {
  var e = navigator.userAgent;
  return e.match(/Android/i)?'ANDROID'
  : e.match(/BlackBerry/i)?'BLACKBERRY'
  : e.match(/iPhone|iPad|iPod/i)?'IOS'
  : e.match(/Opera Mini/i)?'OPERA'
  : e.match(/Windows/i)?'WINDOWS'
  : e.match(/iMac/i)?'MACOS'
  : e.match(/Linux/i)?'LINUX'
  : 'WEB'
}, 
b5.Utils.GetLanguage = function() {
	var t = navigator.language.split("-");
  return {language: t[0], region: t[1]};
},
b5.Utils.GetScreenRefreshRate = function(e) {
 var t=self.requestAnimationFrame;
 t(function(o){
 t(function(a){e&&e(Math.floor(1e3/(a-o))); })});
},
b5.Utils.GetCenterPos = function(e,t,o,a) {
  return { left: (e/2)-(o/2), top: (t/2)-(a/2) }
},
b5.Utils.FileToObjectURL = function(e,t) {
  fetch(e).then(function(r){ 
    r.blob().then(function(blob){
      t && t(URL.createObjectURL(blob));
    })});
},
b5.Utils.HasTouchscreen = function() {
  return 'ontouchstart' in document;
},
b5.Utils.GetOrientation = function() {
  return (screen.orientation||{}).type || "";
},
b5.Utils.SetOrientation = function(e) {
	e ? screen.orientation.lock(e).catch(a=>{
		console.warn(a.message);
	}) : screen.orientation.unlock().catch(a=>{
		console.warn(a.message);
	});
},
/* Back button Override (Mobile platforms only)*/
b5.Utils.SetBackButtonEnabled = function(e) {
  var t = () => { b5.Utils.IsMobile() && history.pushState('back-button-override',null)};
  !e ? (
    history.length < 2 && t(),
  	window.onpopstate = t
  ) : (window.onpopstate = null, history.length > 1 && history.back())
},
b5.Utils.pickFile = function(e,t,a,n) {
	void 0 === t && (t = "");
	var o = document.createElement('input');
	o.type = 'file',
	o.accept = t,
	o.multiple = !!e,
	o.onabort = n,
	o.click();
  o.oninput = ()=>{a && a(o.files)};
},
b5.Utils.saveFile = function(e,t) {
	var o = document.createElement('a');
	o.href = t,
	o.download = e,
    o.target = '_blank'
	o.click();
},
b5.Utils.overlapTest = function(z,l) {
  var t = z.x,
  o = z.y,
  a = z.w/2,
  n = z.h/2,
  r = l.x,
  i = l.y,
  s = l.w/2,
  c = l.h/2;
  return t-a < r+s && t+a > r-s && o-n < i+c && o+n > i-c
},
b5.Utils.getStatusCodeString = function(e) {
	var t = {
    '1000': 'Normal Closure',
    '1001': 'Going Away',
    '1002': 'Protocol Error',
    '1003': 'Unsupported Data',
    '1004': '(For future)',
    '1005': 'No Status Received',
    '1006': 'Abnormal Closure',
    '1007': 'Invalid frame payload data',
    '1008': 'Policy Violation',
    '1009': 'Message too big',
    '1010': 'Missing Extension',
    '1011': 'Internal Error',
    '1012': 'Service Restart',
    '1013': 'Try Again Later',
    '1014': 'Bad Gateway',
    '1015': 'TLS Handshake'
  };
  if (e >= 0 && e <= 999) {
  	return '(Unused)';
  } else if (e >= 1016) {
      if (e <= 1999) {
          return '(For WebSocket standard)';
      } else if (e <= 2999) {
          return '(For WebSocket extensions)';
      } else if (e <= 3999) {
          return '(For libraries and frameworks)';
      } else if (e <= 4999) {
          return '(For applications)';
      }
  }
  if (typeof(t[e]) !== 'undefined') {
      return t[e];
  }
  return '(Unknown)';
},
b5.Utils.prototype.GetLocalIPAddress = function(){return ""},
'use strict';
